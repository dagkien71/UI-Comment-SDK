"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommentStatus=void 0,(e=exports.CommentStatus||(exports.CommentStatus={})).BUG="bug",e.FEATURE_REQUEST="feature_request",e.DEV_COMPLETED="dev_completed",e.DONE="done",e.ARCHIVED="archived";const t={developer:{bg:"#dbeafe",text:"#1e40af",border:"#3b82f6"},designer:{bg:"#fef3c7",text:"#92400e",border:"#f59e0b"},"product-manager":{bg:"#dcfce7",text:"#166534",border:"#22c55e"},qa:{bg:"#fce7f3",text:"#be185d",border:"#ec4899"},stakeholder:{bg:"#e0e7ff",text:"#3730a3",border:"#6366f1"},other:{bg:"#f3f4f6",text:"#374151",border:"#6b7280"}};function o(e){return t[e]||t.other}function n(e){return{developer:"Developer",designer:"Designer","product-manager":"Product Manager",qa:"QA",stakeholder:"Stakeholder",other:"Other"}[e]||"Other"}function i(e,t){void 0===t&&(t={});var o=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===o&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}i('.uicm-comment-sidebar{background:#fff;border-left:1px solid #e5e7eb;box-shadow:-4px 0 12px rgba(0,0,0,.1);display:flex;flex-direction:column;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;height:100vh;opacity:1;pointer-events:auto;position:fixed;right:0;top:0;transform:translateX(100%);transition:transform .3s cubic-bezier(.4,0,.2,1);visibility:visible;width:320px;z-index:9999999999}.uicm-comment-sidebar.show{transform:translateX(0)}.uicm-sidebar-header{align-items:center;background:linear-gradient(135deg,#f8fafc,#f1f5f9);border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;padding:16px 20px}.uicm-sidebar-title{color:#1e293b;font-size:16px;font-weight:600;margin:0}.uicm-sidebar-close{background:none;border:none;border-radius:4px;color:#64748b;cursor:pointer;font-size:18px;padding:4px;transition:all .2s ease}.uicm-sidebar-close:hover{background-color:#f1f5f9;color:#374151}.uicm-sidebar-tabs{background:linear-gradient(135deg,#f8fafc,#f1f5f9);border-bottom:1px solid #e5e7eb;display:flex;padding:0;position:relative}.uicm-sidebar-tabs:after{background:linear-gradient(90deg,transparent,#e5e7eb,transparent);bottom:0;content:"";height:1px;left:0;position:absolute;right:0}.uicm-sidebar-tab{align-items:center;background:none;border:none;border-bottom:3px solid transparent;color:#64748b;cursor:pointer;display:flex;flex:1;font-size:13px;font-weight:600;gap:6px;justify-content:center;letter-spacing:.5px;padding:16px 20px;position:relative;text-transform:uppercase;transition:all .3s cubic-bezier(.4,0,.2,1)}.uicm-sidebar-tab:before{background:linear-gradient(135deg,rgba(59,130,246,.05),rgba(59,130,246,.02));bottom:0;content:"";left:0;opacity:0;position:absolute;right:0;top:0;transition:opacity .3s ease}.uicm-sidebar-tab:hover{background:linear-gradient(135deg,rgba(59,130,246,.08),rgba(59,130,246,.04));color:#374151}.uicm-sidebar-tab:hover:before{opacity:1}.uicm-sidebar-tab.active{background:linear-gradient(135deg,#fff,#f8fafc);border-bottom-color:#3b82f6;box-shadow:0 1px 3px rgba(0,0,0,.1);color:#1e40af;position:relative}.uicm-sidebar-tab.active:after{background:#3b82f6;bottom:-1px;box-shadow:0 0 8px rgba(59,130,246,.3);content:"";height:1px;left:0;position:absolute;right:0}.uicm-sidebar-tab.active:hover{background:linear-gradient(135deg,#fff,#f1f5f9);color:#1e3a8a}.uicm-sidebar-tab:after{background:linear-gradient(90deg,#3b82f6,#06b6d4);border-radius:2px 2px 0 0;bottom:0;content:"";height:3px;left:50%;position:absolute;transform:translateX(-50%);transition:width .3s cubic-bezier(.4,0,.2,1);width:0}.uicm-sidebar-tab.active:after{width:60%}.uicm-sidebar-filter-toggle{align-items:center;background:linear-gradient(135deg,#374151,#4b5563);border-top:none;color:#fff;cursor:pointer;display:flex;font-size:13px;font-weight:600;justify-content:space-between;padding:12px 20px;position:relative;width:100%}.uicm-filter-toggle-icon{font-size:14px;opacity:.7}.uicm-filter-toggle-text{color:inherit;font-size:13px;font-weight:600}.uicm-filter-toggle-arrow{font-size:10px;opacity:.6;transition:transform .3s ease}.uicm-sidebar-filters{background:linear-gradient(135deg,#fff,#f8fafc);border-bottom:1px solid #e5e7eb;overflow:hidden;padding:20px;position:relative;transition:all .3s cubic-bezier(.4,0,.2,1)}.uicm-sidebar-filters-closed{border-bottom:none;max-height:0;opacity:0;padding-bottom:0;padding-top:0}.uicm-sidebar-filters-open{max-height:300px;opacity:1}.uicm-sidebar-filters:before{background:linear-gradient(90deg,transparent,#e5e7eb,transparent);content:"";height:1px;left:0;position:absolute;right:0;top:0}.uicm-sidebar-filter-header{align-items:center;border-bottom:1px solid #f1f5f9;display:flex;gap:8px;margin-bottom:16px;padding-bottom:12px}.uicm-sidebar-filter-icon{font-size:14px;opacity:.7}.uicm-sidebar-filter-title{color:#374151;font-size:13px;font-weight:600;letter-spacing:.2px;text-transform:none}.uicm-sidebar-filter-buttons{display:grid;gap:10px;grid-template-columns:1fr 1fr}.uicm-status-filter-btn{align-items:center;background:linear-gradient(145deg,hsla(0,0%,100%,.95),rgba(248,250,252,.9));border:1px solid rgba(226,232,240,.8);border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.05),0 1px 2px rgba(0,0,0,.1);color:#64748b;cursor:pointer;display:flex;flex-direction:column;font-size:12px;font-weight:500;gap:6px;letter-spacing:.2px;overflow:hidden;padding:12px 8px;position:relative;text-transform:none;transition:all .3s cubic-bezier(.4,0,.2,1)}.uicm-status-filter-btn:before{background:linear-gradient(135deg,rgba(59,130,246,.05),rgba(59,130,246,.02));bottom:0;content:"";left:0;opacity:0;position:absolute;right:0;top:0;transition:opacity .3s ease}.uicm-status-filter-btn:hover{background:linear-gradient(145deg,#fff,rgba(248,250,252,.95));border-color:rgba(59,130,246,.2);box-shadow:0 4px 12px rgba(59,130,246,.15),0 2px 4px rgba(0,0,0,.1);transform:translateY(-2px)}.uicm-status-filter-btn:hover:before{opacity:1}.uicm-status-filter-btn.active{background:linear-gradient(145deg,var(--status-color,#3b82f6),var(--status-color-dark,#2563eb));border-color:var(--status-color-dark,#1d4ed8);box-shadow:0 6px 20px rgba(var(--status-color-rgb,59,130,246),.3),0 2px 8px rgba(var(--status-color-rgb,59,130,246),.2);color:#fff;transform:translateY(-2px)}.uicm-status-filter-btn.active:hover{background:linear-gradient(145deg,var(--status-color-dark,#2563eb),var(--status-color-darker,#1d4ed8));box-shadow:0 8px 25px rgba(var(--status-color-rgb,59,130,246),.4),0 4px 12px rgba(var(--status-color-rgb,59,130,246),.3)}.uicm-filter-btn-icon{display:block;font-size:16px}.uicm-filter-btn-text{font-size:11px;font-weight:600;letter-spacing:.3px;text-transform:uppercase}.uicm-sidebar-stats{background:#f8fafc;border-bottom:1px solid #e5e7eb;color:#64748b;font-size:12px;padding:12px 20px}.uicm-sidebar-stats-content{display:flex;justify-content:space-between}.uicm-sidebar-comments-list{flex:1;overflow-y:auto;padding:0}.uicm-sidebar-comments-list::-webkit-scrollbar{width:6px}.uicm-sidebar-comments-list::-webkit-scrollbar-track{background:#f1f5f9}.uicm-sidebar-comments-list::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.uicm-sidebar-comments-list::-webkit-scrollbar-thumb:hover{background:#94a3b8}.uicm-sidebar-comment-item{background:#fff;border-bottom:1px solid #e5e7eb;cursor:pointer;padding:12px;transition:all .2s ease}.uicm-sidebar-comment-item:hover{background-color:#f8fafc}.uicm-sidebar-comment-header{align-items:center;display:flex;gap:8px;margin-bottom:6px}.uicm-sidebar-comment-avatar{align-items:center;background:linear-gradient(135deg,#3b82f6,#06b6d4);border-radius:50%;color:#fff;display:flex;flex-shrink:0;font-size:10px;font-weight:600;height:24px;justify-content:center;width:24px}.uicm-sidebar-comment-user-info{display:flex;flex:1;flex-direction:column;gap:2px;min-width:0}.uicm-sidebar-comment-name-row{align-items:center;display:flex;flex-wrap:wrap;gap:6px}.uicm-sidebar-comment-name{color:#1e293b;font-size:12px;font-weight:600}.uicm-sidebar-comment-role{border:1px solid;border-radius:4px;font-size:9px;font-weight:600;letter-spacing:.3px;padding:1px 4px;text-transform:uppercase}.uicm-sidebar-comment-time{color:#64748b;font-size:10px;margin-left:auto}.uicm-sidebar-comment-page{color:#3b82f6;font-size:10px;font-weight:500}.uicm-sidebar-comment-content{-webkit-line-clamp:2;-webkit-box-orient:vertical;color:#374151;display:-webkit-box;font-size:12px;line-height:1.4;margin-bottom:6px;overflow:hidden}.uicm-sidebar-comment-footer{align-items:center;display:flex;gap:8px;justify-content:space-between}.uicm-sidebar-comment-status{border-radius:4px;font-size:9px;font-weight:600;letter-spacing:.3px;padding:2px 6px;text-transform:uppercase}.uicm-sidebar-comment-replies{align-items:center;color:#64748b;display:flex;font-size:10px;gap:2px}.uicm-sidebar-comment-replies-icon{font-size:8px}.uicm-sidebar-empty{color:#64748b;padding:40px 20px;text-align:center}.uicm-sidebar-empty-icon{font-size:48px;margin-bottom:16px}.uicm-sidebar-empty-title{font-size:14px;font-weight:500;margin-bottom:8px}.uicm-sidebar-empty-subtitle{font-size:12px}@media (prefers-color-scheme:dark){.uicm-comment-sidebar{background:#1f2937;border-left-color:#374151;color:#f9fafb}.uicm-sidebar-header{background:linear-gradient(135deg,#374151,#4b5563);border-bottom-color:#374151}.uicm-sidebar-title{color:#f9fafb}.uicm-sidebar-tabs{background:linear-gradient(135deg,#374151,#4b5563);border-bottom-color:#4b5563}.uicm-sidebar-tabs:after{background:linear-gradient(90deg,transparent,#4b5563,transparent)}.uicm-sidebar-tab{color:#9ca3af}.uicm-sidebar-tab:before{background:linear-gradient(135deg,rgba(96,165,250,.1),rgba(96,165,250,.05))}.uicm-sidebar-tab:hover{background:linear-gradient(135deg,rgba(96,165,250,.15),rgba(96,165,250,.08));color:#d1d5db}.uicm-sidebar-tab.active{background:linear-gradient(135deg,#1f2937,#374151);box-shadow:0 1px 3px rgba(0,0,0,.3);color:#60a5fa}.uicm-sidebar-tab.active:after{background:#60a5fa;box-shadow:0 0 8px rgba(96,165,250,.4)}.uicm-sidebar-tab.active:hover{background:linear-gradient(135deg,#1f2937,#4b5563);color:#93c5fd}.uicm-sidebar-tab:after{background:linear-gradient(90deg,#60a5fa,#06b6d4)}.uicm-sidebar-stats{background:#374151;border-bottom-color:#4b5563;color:#d1d5db}.uicm-sidebar-comment-item{background:#1f2937;border-bottom-color:#374151}.uicm-sidebar-comment-item:hover{background-color:#374151}.uicm-sidebar-comment-name{color:#f9fafb}.uicm-sidebar-comment-content{color:#d1d5db}}@media (max-width:640px){.uicm-comment-sidebar{width:100vw}}');class s{constructor(e){this.isVisible=!1,this.currentTab="active",this.currentStatusFilter="all",this.isFilterOpen=!1,this.commentsList=null,this.statsContent=null,this.filterContainer=null,this.filterToggleBtn=null,console.log("🔧 CommentSidebar: Constructor called with",e.comments.length,"comments"),this.props=e,this.element=this.createElement(),console.log("🔧 CommentSidebar: Element created:",this.element),this.attachEventListeners()}formatTimeAgo(e){const t=new Date,o=new Date(e),n=Math.floor((t.getTime()-o.getTime())/1e3);return n<60?"just now":n<3600?`${Math.floor(n/60)}m ago`:n<86400?`${Math.floor(n/3600)}h ago`:n<2592e3?`${Math.floor(n/86400)}d ago`:o.toLocaleDateString()}getStatusColor(e){switch(e){case exports.CommentStatus.BUG:return{bg:"#dc3545",text:"white"};case exports.CommentStatus.FEATURE_REQUEST:return{bg:"#ffc107",text:"black"};case exports.CommentStatus.DEV_COMPLETED:return{bg:"#3b82f6",text:"white"};case exports.CommentStatus.DONE:return{bg:"#28a745",text:"white"};case exports.CommentStatus.ARCHIVED:return{bg:"#6c757d",text:"white"};default:return{bg:"#007bff",text:"white"}}}getPageName(e){try{const t=new URL(e).pathname;if("/"===t||""===t)return"Home";const o=t.split("/").filter(Boolean);if(0===o.length)return"Home";return o[o.length-1].split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")||"Unknown Page"}catch{return"Unknown Page"}}getFilteredComments(){let e;return e="active"===this.currentTab?this.props.comments.filter(e=>"archived"!==e.status):this.props.comments.filter(e=>"archived"===e.status),"all"!==this.currentStatusFilter&&(e=e.filter(e=>e.status===this.currentStatusFilter)),e}switchTab(e){this.currentTab=e,this.updateCommentsDisplay(),this.updateStats(),this.updateTabStates()}switchStatusFilter(e){this.currentStatusFilter=e,this.updateCommentsDisplay(),this.updateStats(),this.updateFilterStates()}toggleFilter(){if(this.isFilterOpen=!this.isFilterOpen,this.filterContainer&&(this.isFilterOpen?(this.filterContainer.classList.remove("uicm-sidebar-filters-closed"),this.filterContainer.classList.add("uicm-sidebar-filters-open")):(this.filterContainer.classList.remove("uicm-sidebar-filters-open"),this.filterContainer.classList.add("uicm-sidebar-filters-closed"))),this.filterToggleBtn){const e=this.filterToggleBtn.querySelector(".uicm-filter-toggle-arrow");e&&(e.textContent=this.isFilterOpen?"▲":"▼")}}updateCommentsDisplay(){if(!this.commentsList)return;this.commentsList.innerHTML="";const e=this.getFilteredComments();if(0===e.length){const e=document.createElement("div");e.className="uicm-sidebar-empty";const t="active"===this.currentTab?"No active comments yet":"No archived comments",o="active"===this.currentTab?"Start commenting on any element to see them here":"Archived comments will appear here";e.innerHTML=`\n        <div class="uicm-sidebar-empty-icon">��</div>\n        <div class="uicm-sidebar-empty-title">${t}</div>\n        <div class="uicm-sidebar-empty-subtitle">${o}</div>\n      `,this.commentsList.appendChild(e)}else e.forEach(e=>{const t=this.createCommentItem(e);this.commentsList.appendChild(t)})}updateStats(){if(!this.statsContent)return;const e=this.props.comments.filter(e=>"archived"!==e.status).length,t=this.props.comments.filter(e=>"archived"===e.status).length,o=this.props.comments.reduce((e,t)=>e+t.replies.length,0);this.statsContent.innerHTML=`\n      <span>📝 ${"active"===this.currentTab?e:t} ${"active"===this.currentTab?"active":"archived"}</span>\n      <span>💬 ${o} replies</span>\n      <span>📊 ${e+t} total</span>\n    `}createCommentItem(e){const t=document.createElement("div");t.className="uicm-sidebar-comment-item",t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),console.log("🔧 Sidebar: Comment item clicked:",e.id),this.props.onNavigateToComment(e)});const i=document.createElement("div");i.className="uicm-sidebar-comment-header";const s=document.createElement("div");s.className="uicm-sidebar-comment-avatar";let a="?";e&&e.createdBy&&"string"==typeof e.createdBy.name&&e.createdBy.name.length>0?a=e.createdBy.name.charAt(0).toUpperCase():console.warn("Sidebar: Comment missing createdBy or name",e),s.textContent=a;const r=document.createElement("div");r.className="uicm-sidebar-comment-user-info";const l=document.createElement("div");l.className="uicm-sidebar-comment-name-row";const c=document.createElement("span");c.className="uicm-sidebar-comment-name",c.textContent=e.createdBy.name;const m=document.createElement("span");m.className="uicm-sidebar-comment-role";const d=o(e.role);m.style.backgroundColor=d.bg,m.style.color=d.text,m.style.borderColor=d.border,m.textContent=n(e.role);const p=document.createElement("span");p.className="uicm-sidebar-comment-time",p.textContent=this.formatTimeAgo(e.createdAt),l.appendChild(c),l.appendChild(m),l.appendChild(p);const u=document.createElement("div");u.className="uicm-sidebar-comment-page",u.textContent=this.getPageName(e.url),r.appendChild(l),r.appendChild(u),i.appendChild(s),i.appendChild(r);const h=document.createElement("div");h.className="uicm-sidebar-comment-content",h.textContent=e.content;const g=document.createElement("div");g.className="uicm-sidebar-comment-footer";const b=document.createElement("span");b.className="uicm-sidebar-comment-status";const f=this.getStatusColor(e.status);b.style.backgroundColor=f.bg,b.style.color=f.text,b.textContent=e?.status?.toUpperCase();const x=document.createElement("span");x.className="uicm-sidebar-comment-replies";const y=document.createElement("span");return y.className="uicm-sidebar-comment-replies-icon",y.textContent="💬",x.appendChild(y),x.appendChild(document.createTextNode(`${e.replies.length}`)),g.appendChild(b),g.appendChild(x),t.appendChild(i),t.appendChild(h),t.appendChild(g),t}createElement(){const e=document.createElement("div");e.className="uicm-comment-sidebar";const t=document.createElement("div");t.className="uicm-sidebar-header";const o=document.createElement("h3");o.className="uicm-sidebar-title",o.textContent="All Comments";const n=document.createElement("button");n.className="uicm-sidebar-close",n.innerHTML="×",n.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.props.onClose()}),t.appendChild(o),t.appendChild(n);const i=document.createElement("div");i.className="uicm-sidebar-tabs";const s=document.createElement("button");s.className="uicm-sidebar-tab uicm-sidebar-tab-active",s.textContent="Active",s.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.switchTab("active")});const a=document.createElement("button");a.className="uicm-sidebar-tab",a.textContent="Archive",a.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.switchTab("archive")}),i.appendChild(s),i.appendChild(a),this.filterToggleBtn=document.createElement("button"),this.filterToggleBtn.className="uicm-sidebar-filter-toggle",this.filterToggleBtn.innerHTML='\n      <span class="uicm-filter-toggle-icon">🔍</span>\n      <span class="uicm-filter-toggle-text">Filter</span>\n      <span class="uicm-filter-toggle-arrow">▼</span>\n    ',this.filterToggleBtn.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.toggleFilter()}),this.filterContainer=document.createElement("div"),this.filterContainer.className="uicm-sidebar-filters uicm-sidebar-filters-closed";const r=document.createElement("div");r.className="uicm-sidebar-filter-header";const l=document.createElement("span");l.className="uicm-sidebar-filter-icon",l.innerHTML="🔍";const c=document.createElement("div");c.className="uicm-sidebar-filter-title",c.textContent="Filter by Status",r.appendChild(l),r.appendChild(c);const m=document.createElement("div");m.className="uicm-sidebar-filter-buttons";const d=document.createElement("button");d.className="uicm-status-filter-btn active",d.setAttribute("data-status","all"),d.innerHTML='\n      <span class="uicm-filter-btn-icon">📋</span>\n      <span class="uicm-filter-btn-text">All</span>\n    ',d.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.switchStatusFilter("all")});[{status:exports.CommentStatus.BUG,label:"Bug",icon:"🐛",color:"#dc3545",colorDark:"#c82333",colorDarker:"#a71e2a",colorRgb:"220, 53, 69"},{status:exports.CommentStatus.FEATURE_REQUEST,label:"Feature",icon:"💡",color:"#ffc107",colorDark:"#e0a800",colorDarker:"#d39e00",colorRgb:"255, 193, 7"},{status:exports.CommentStatus.DEV_COMPLETED,label:"Dev Done",icon:"✅",color:"#3b82f6",colorDark:"#2563eb",colorDarker:"#1d4ed8",colorRgb:"59, 130, 246"},{status:exports.CommentStatus.DONE,label:"Done",icon:"🎉",color:"#28a745",colorDark:"#218838",colorDarker:"#1e7e34",colorRgb:"40, 167, 69"}].forEach(({status:e,label:t,icon:o,color:n,colorDark:i,colorDarker:s,colorRgb:a})=>{const r=document.createElement("button");r.className="uicm-status-filter-btn",r.setAttribute("data-status",e),r.setAttribute("data-color",n),r.innerHTML=`\n        <span class="uicm-filter-btn-icon">${o}</span>\n        <span class="uicm-filter-btn-text">${t}</span>\n      `,r.style.setProperty("--status-color",n),r.style.setProperty("--status-color-dark",i),r.style.setProperty("--status-color-darker",s),r.style.setProperty("--status-color-rgb",a),r.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.switchStatusFilter(e)}),m.appendChild(r)}),this.filterContainer.appendChild(r),this.filterContainer.appendChild(m);const p=document.createElement("div");p.className="uicm-sidebar-stats";const u=this.props.comments.filter(e=>"archived"!==e.status).length,h=this.props.comments.filter(e=>"archived"===e.status).length,g=this.props.comments.reduce((e,t)=>e+t.replies.length,0);return this.statsContent=document.createElement("div"),this.statsContent.className="uicm-sidebar-stats-content",this.statsContent.innerHTML=`\n      <span>📝 ${u} active</span>\n      <span>💬 ${g} replies</span>\n      <span>📊 ${u+h} total</span>\n    `,p.appendChild(this.statsContent),this.commentsList=document.createElement("div"),this.commentsList.className="uicm-sidebar-comments-list",this.updateCommentsDisplay(),e.appendChild(t),e.appendChild(i),e.appendChild(this.filterToggleBtn),e.appendChild(this.filterContainer),e.appendChild(p),e.appendChild(this.commentsList),e}attachEventListeners(){const e=e=>{"Escape"===e.key&&this.isVisible&&this.props.onClose()};document.addEventListener("keydown",e),this.element.addEventListener("destroy",()=>{document.removeEventListener("keydown",e)})}show(){this.isVisible=!0,document.body.appendChild(this.element),this.element.offsetHeight,this.element.classList.add("show")}hide(){console.log("🔧 CommentSidebar: hide() called"),this.isVisible=!1,this.element.classList.remove("show"),setTimeout(()=>{this.element.parentNode&&(this.element.parentNode.removeChild(this.element),console.log("🔧 CommentSidebar: Element removed from DOM"))},300)}updateComments(e){this.props.comments=e,this.updateCommentsDisplay(),this.updateStats(),this.updateTabStates(),this.updateFilterStates()}updateTabStates(){const e=this.element.querySelector(".uicm-sidebar-tab.active"),t=this.element.querySelector(".uicm-sidebar-tab.archive");e&&e.classList.toggle("active","active"===this.currentTab),t&&t.classList.toggle("active","archive"===this.currentTab)}updateFilterStates(){if(!this.filterContainer)return;this.filterContainer.querySelectorAll(".uicm-status-filter-btn").forEach(e=>{const t=e.getAttribute("data-status");t===this.currentStatusFilter||"all"===t&&"all"===this.currentStatusFilter?e.classList.add("active"):e.classList.remove("active")})}getElement(){return this.element}destroy(){this.hide(),this.element.dispatchEvent(new Event("destroy"))}}class a{constructor(e){this.props=e,this.element=this.createElement(),this.attachEventListeners()}createElement(){const e=document.createElement("div");return e.className="uicm-debug-icon",e.setAttribute("data-uicm-element","true"),e.style.position="fixed",e.style.right="20px",e.style.top="20px",e.style.width="40px",e.style.height="40px",e.style.borderRadius="50%",e.style.backgroundColor=this.props.isActive?"rgba(255, 0, 0, 0.8)":"rgba(0, 0, 0, 0.5)",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.cursor="pointer",e.style.transition="all 0.3s ease",e.style.zIndex="999999",e.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.2)",e.style.pointerEvents="auto",e.addEventListener("mouseenter",()=>{e.style.transform="scale(1.1)",e.style.backgroundColor=this.props.isActive?"rgba(255, 0, 0, 1)":"rgba(0, 0, 0, 0.8)"}),e.addEventListener("mouseleave",()=>{e.style.transform="scale(1)",e.style.backgroundColor=this.props.isActive?"rgba(255, 0, 0, 0.8)":"rgba(0, 0, 0, 0.5)"}),e.innerHTML=this.getIconHTML(),e}getIconHTML(){return this.props.isActive?'\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n        </svg>\n      ':'\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n          <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/>\n        </svg>\n      '}attachEventListeners(){this.element.addEventListener("click",e=>{e.stopPropagation(),this.props.onClick()});let e=null;this.element.addEventListener("mouseenter",()=>{e=this.createTooltip(),document.body.appendChild(e)}),this.element.addEventListener("mouseleave",()=>{e&&(e.remove(),e=null)})}createTooltip(){const e=document.createElement("div");e.className="uicm-tooltip",e.setAttribute("data-uicm-element","true");const t=this.element.getBoundingClientRect();return e.style.left=`${t.right+8}px`,e.style.top=t.top+t.height/2-12+"px",e}updateState(e){this.props.isActive=e,this.element.className="uicm-debug-icon",this.element.style.backgroundColor=this.props.isActive?"rgba(255, 0, 0, 0.8)":"rgba(0, 0, 0, 0.5)",this.element.innerHTML=this.getIconHTML()}updateTheme(e){this.props.theme=e}getElement(){return this.element}destroy(){document.querySelectorAll(".uicm-tooltip").forEach(e=>e.remove()),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}class r{static async loadComments(){try{const e=this.loadFromLocalStorage(),t=await this.loadFromJsonFile();return this.mergeComments(e,t)}catch(e){return console.error("Failed to load comments:",e),[]}}static loadFromLocalStorage(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){return JSON.parse(e).comments||[]}}catch(e){console.error("Failed to load from localStorage:",e)}return[]}static async loadFromJsonFile(){try{if("undefined"!=typeof window&&"localhost"===window.location.hostname){const e=await fetch(this.JSON_FILE_PATH);if(e.ok){return(await e.json()).comments||[]}}}catch(e){console.log("Could not load from JSON file (this is normal in production):",e.message)}return[]}static mergeComments(e,t){const o=new Map;return t.forEach(e=>{o.set(e.id,e)}),e.forEach(e=>{o.set(e.id,e)}),Array.from(o.values())}static async saveComments(e){try{this.saveToLocalStorage(e),await this.saveToJsonFile(e)}catch(e){console.error("Failed to save comments:",e)}}static saveToLocalStorage(e){try{const t={comments:e,lastUpdated:(new Date).toISOString(),source:"hybrid-storage"};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(e){console.error("Failed to save to localStorage:",e)}}static async saveToJsonFile(e){try{if("undefined"!=typeof window&&"localhost"===window.location.hostname){const t={comments:e,lastUpdated:(new Date).toISOString(),version:"1.0.0",source:"hybrid-storage"},o=JSON.stringify(t,null,2);console.log("📝 Copy this JSON to src/storage/comments.json:"),console.log(o),this.downloadJsonFile(o)}}catch(e){console.error("Failed to save to JSON file:",e)}}static downloadJsonFile(e){try{const t=new Blob([e],{type:"application/json"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download="comments.json",n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o),console.log("💾 Downloaded comments.json - Please replace src/storage/comments.json with this file")}catch(e){console.error("Failed to download JSON file:",e)}}static async addComment(e){const t=await this.loadComments(),o={...e,id:this.generateId(),createdAt:(new Date).toISOString()};return t.push(o),await this.saveComments(t),o}static async updateComment(e){const t=await this.loadComments(),o=t.findIndex(t=>t.id===e.id);return-1!==o&&(t[o]=e,await this.saveComments(t)),e}static async deleteComment(e){const t=(await this.loadComments()).filter(t=>t.id!==e);await this.saveComments(t)}static async updateUserNameInAllComments(e,t){const o=await this.loadComments();let n=!1;for(const i of o){i.createdBy.id===e&&(i.createdBy.name=t,n=!0);for(const o of i.replies)o.createdBy.id===e&&(o.createdBy.name=t,n=!0)}n?(await this.saveComments(o),console.log(`✅ Updated user name from ${e} to "${t}" in all comments`)):console.log(`ℹ️ No comments found for user ${e}`)}static async getCommentsForUrl(e){return(await this.loadComments()).filter(t=>t.url===e)}static generateId(){return"comment_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}static async clearAllComments(){localStorage.removeItem(this.STORAGE_KEY),await this.saveComments([])}static async syncToFile(){const e=this.loadFromLocalStorage();await this.saveToJsonFile(e),console.log("✅ Synced localStorage comments to JSON file")}static async importFromFile(){const e=await this.loadFromJsonFile();this.saveToLocalStorage(e),console.log("✅ Imported file comments to localStorage")}}r.STORAGE_KEY="uicm-comments",r.JSON_FILE_PATH="/src/storage/comments.json";class l{constructor(e){this.props=e,this.element=this.createElement(),this.attachEventListeners()}createElement(){const e=document.createElement("div");return e.className="uicm-profile-modal",e.innerHTML=`\n      <div class="uicm-profile-modal-overlay"></div>\n      <div class="uicm-profile-modal-content">\n        <div class="uicm-profile-modal-header">\n          <h3 class="uicm-profile-modal-title">Profile Settings</h3>\n          <button class="uicm-profile-modal-close" type="button">\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n          </button>\n        </div>\n        \n        <div class="uicm-profile-modal-body">\n          <div class="uicm-profile-avatar-section">\n            <div class="uicm-profile-avatar">\n              <span class="uicm-profile-avatar-text">${this.props.currentUser.name.charAt(0).toUpperCase()}</span>\n            </div>\n            <div class="uicm-profile-avatar-info">\n              <p class="uicm-profile-avatar-label">Profile Picture</p>\n              <p class="uicm-profile-avatar-subtitle">Avatar will be generated from your name</p>\n            </div>\n          </div>\n\n          <form class="uicm-profile-form">\n            <div class="uicm-form-group">\n              <label class="uicm-form-label" for="profile-name">Name</label>\n              <input \n                type="text" \n                id="profile-name" \n                class="uicm-form-input" \n                value="${this.props.currentUser.name}"\n                placeholder="Enter your name"\n                maxlength="50"\n              />\n              <div class="uicm-form-help">This name will be displayed on your comments</div>\n            </div>\n\n            <div class="uicm-form-group">\n              <label class="uicm-form-label" for="profile-role">Role</label>\n              <select id="profile-role" class="uicm-form-select">\n                <option value="developer" ${"developer"===this.props.currentUser.role?"selected":""}>Developer</option>\n                <option value="designer" ${"designer"===this.props.currentUser.role?"selected":""}>Designer</option>\n                <option value="product-manager" ${"product-manager"===this.props.currentUser.role?"selected":""}>Product Manager</option>\n                <option value="qa" ${"qa"===this.props.currentUser.role?"selected":""}>QA Tester</option>\n                <option value="stakeholder" ${"stakeholder"===this.props.currentUser.role?"selected":""}>Stakeholder</option>\n                <option value="other" ${"other"===this.props.currentUser.role?"selected":""}>Other</option>\n              </select>\n              <div class="uicm-form-help">Your role helps others understand your perspective</div>\n            </div>\n          </form>\n        </div>\n\n        <div class="uicm-profile-modal-footer">\n          <button class="uicm-btn uicm-btn-secondary" type="button">Cancel</button>\n          <button class="uicm-btn uicm-btn-primary" type="button">Save Changes</button>\n        </div>\n      </div>\n    `,e}attachEventListeners(){const e=this.element.querySelector(".uicm-profile-modal-content");e&&e.addEventListener("click",e=>{e.stopPropagation()});const t=this.element.querySelector(".uicm-profile-modal-close");t&&t.addEventListener("click",e=>{e.stopPropagation(),this.props.onClose()});const o=this.element.querySelector(".uicm-btn-secondary");o&&o.addEventListener("click",e=>{e.stopPropagation(),this.props.onClose()});const n=this.element.querySelector(".uicm-btn-primary");n&&n.addEventListener("click",async e=>{e.stopPropagation(),await this.handleSave()});const i=this.element.querySelector(".uicm-profile-modal-overlay");i&&i.addEventListener("click",e=>{e.stopPropagation(),this.props.onClose()}),this.element.addEventListener("click",e=>{e.stopPropagation()}),this.element.addEventListener("mousedown",e=>{e.stopPropagation()}),this.element.addEventListener("mouseup",e=>{e.stopPropagation()}),this.element.addEventListener("keydown",e=>{e.stopPropagation()}),this.element.addEventListener("keyup",e=>{e.stopPropagation()});const s=e=>{"Escape"===e.key&&this.props.onClose()};document.addEventListener("keydown",s),this.element.addEventListener("remove",()=>{document.removeEventListener("keydown",s)});const a=this.element.querySelector("#profile-name"),r=this.element.querySelector(".uicm-profile-avatar-text");a&&r&&a.addEventListener("input",e=>{e.stopPropagation();const t=a.value.trim();r.textContent=t?t.charAt(0).toUpperCase():this.props.currentUser.name.charAt(0).toUpperCase()})}async handleSave(){const e=this.element.querySelector("#profile-name"),t=this.element.querySelector("#profile-role"),o=this.element.querySelector(".uicm-btn-primary");if(!e||!t||!o)return;const n=e.value.trim(),i=t.value;if(n){e.classList.remove("uicm-form-input-error"),o.disabled=!0,o.textContent="Saving...";try{const e={...this.props.currentUser,name:n,role:i},t=this.props.currentUser.name!==n;await this.props.onSave(e),t&&(console.log(`🔄 Updating user name from "${this.props.currentUser.name}" to "${n}" in all comments...`),await r.updateUserNameInAllComments(this.props.currentUser.id,n)),console.log("✅ Profile updated successfully"),this.props.onClose()}catch(e){console.error("Failed to update profile:",e),o.disabled=!1,o.textContent="Save Changes"}}else e.classList.add("uicm-form-input-error")}getElement(){return this.element}destroy(){document.removeEventListener("keydown",e=>{"Escape"===e.key&&this.props.onClose()}),this.element.remove()}}class c{constructor(e="uicm-user-profile"){this.storageKey=e}saveUserProfile(e){try{const t=JSON.stringify(e);localStorage.setItem(this.storageKey,t),console.log("✅ User profile saved to localStorage:",e)}catch(e){console.error("Failed to save user profile to localStorage:",e)}}loadUserProfile(){try{const e=localStorage.getItem(this.storageKey);if(!e)return null;const t=JSON.parse(e);return console.log("📂 User profile loaded from localStorage:",t),t}catch(e){return console.error("Failed to load user profile from localStorage:",e),null}}clearUserProfile(){try{localStorage.removeItem(this.storageKey),console.log("🗑️ User profile cleared from localStorage")}catch(e){console.error("Failed to clear user profile from localStorage:",e)}}updateUserProfile(e){try{const t=this.loadUserProfile();if(!t)return null;const o={...t,...e};return this.saveUserProfile(o),console.log("🔄 User profile updated in localStorage:",o),o}catch(e){return console.error("Failed to update user profile in localStorage:",e),null}}}const m=new c;class d{constructor(e){this.profileModal=null,this.props=e,this.element=this.createElement(),this.attachEventListeners()}createElement(){const e=document.createElement("button");return e.className="uicm-settings-button",e.type="button",e.title="Profile Settings",e.style.display=!0===this.props.isVisible?"flex":"none",!0!==this.props.isVisible&&(e.style.opacity="0",e.style.transform="scale(0.8) translateY(20px)"),e.innerHTML='\n      <div class="uicm-settings-icon">\n        <div class="uicm-gear-icon">⚙</div>\n      </div>\n    ',e}attachEventListeners(){this.element.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.openProfileSettings()})}openProfileSettings(){this.profileModal&&(this.profileModal.destroy(),this.profileModal=null),this.profileModal=new l({currentUser:this.props.currentUser,onSave:async e=>{m.saveUserProfile(e),await this.props.onUserUpdate(e),this.props.currentUser=e,console.log("✅ Profile saved to localStorage and updated in SDK")},onClose:()=>{this.profileModal&&(this.profileModal.destroy(),this.profileModal=null)}}),document.body.appendChild(this.profileModal.getElement())}getElement(){return this.element}setVisible(e){e?(this.element.style.display="flex",setTimeout(()=>{this.element.style.opacity="1",this.element.style.transform="scale(1) translateY(0)"},10)):(this.element.style.opacity="0",this.element.style.transform="scale(0.8) translateY(20px)",setTimeout(()=>{this.element.style.display="none"},300))}destroy(){this.profileModal&&(this.profileModal.destroy(),this.profileModal=null),this.element.remove()}}class p{constructor(e){this.props=e,this.element=this.createElement(),this.attachEventListeners()}createElement(){const e=document.createElement("button");return e.className="uicm-sidebar-button",e.type="button",e.title="View All Comments",e.style.display=!0===this.props.isVisible?"flex":"none",!0!==this.props.isVisible&&(e.style.opacity="0",e.style.transform="scale(0.8) translateY(20px)"),e.innerHTML='\n      <div class="uicm-sidebar-icon">\n        <div class="uicm-list-icon">📋</div>\n      </div>\n    ',e}attachEventListeners(){this.element.addEventListener("click",e=>{console.log("🔧 SidebarButton: Clicked!"),e.preventDefault(),e.stopPropagation(),this.props.onClick()})}getElement(){return this.element}setVisible(e){e?(this.element.style.display="flex",setTimeout(()=>{this.element.style.opacity="1",this.element.style.transform="scale(1) translateY(0)"},10)):(this.element.style.opacity="0",this.element.style.transform="scale(0.8) translateY(20px)",setTimeout(()=>{this.element.style.display="none"},300))}updateUser(e){this.props.currentUser=e,console.log("🔄 SidebarButton: User updated:",e.name)}destroy(){this.element.remove()}}function u(e,t,o={}){const{padding:n=16,preferredSide:i="bottom"}=o,s=window.innerWidth,a=window.innerHeight,r=e.getBoundingClientRect(),l=r.width||400,c=r.height||300;let{x:m,y:d}=t;return m+l>s-n&&(m=s-l-n),m<n&&(m=n),d+c>a-n&&(d="top"===i?t.y-c-n:a-c-n),d<n&&(d=n),(m<n||m+l>s-n)&&(m=Math.max(n,(s-l)/2)),(d<n||d+c>a-n)&&(d=Math.max(n,(a-c)/2)),{x:m,y:d}}function h(e,t={}){const{padding:o=16,preferredSide:n="bottom"}=t,i=u(e,{x:parseFloat(e.style.left)||0,y:parseFloat(e.style.top)||0},{padding:o,preferredSide:n});e.style.left=`${i.x}px`,e.style.top=`${i.y}px`}function g(e,t){const o={x:t.clientX,y:t.clientY},n=function(e,t){const o=e.getBoundingClientRect();return{x:Math.max(0,Math.min(1,(t.x-o.left)/o.width)),y:Math.max(0,Math.min(1,(t.y-o.top)/o.height))}}(e,o);return{position:o,relativePosition:n}}function b(){return`uicm_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function f(e,t){let o=null;return(...n)=>{null!==o&&clearTimeout(o),o=setTimeout(()=>e(...n),t)}}function x(e){if(!e)return"";if(e.id)return`//*[@id="${e.id}"]`;const t=[];let o=e;for(;o&&o.nodeType===Node.ELEMENT_NODE;){let e=1,n=!1,i=o.previousSibling;for(;i;)i.nodeType===Node.ELEMENT_NODE&&i.tagName===o.tagName&&(e++,n=!0),i=i.previousSibling;const s=o.tagName.toLowerCase(),a=n?`[${e}]`:"";t.unshift(`${s}${a}`),o=o.parentElement}return`/${t.join("/")}`}const y=new class{constructor(e=5242880){this.maxFileSize=e,this.allowedTypes=["image/jpeg","image/png","image/gif","image/webp","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","application/zip","application/x-rar-compressed"]}async uploadFile(e){if(e.size>this.maxFileSize)throw new Error(`File too large. Maximum size is ${this.formatFileSize(this.maxFileSize)}`);if(-1===this.allowedTypes.indexOf(e.type))throw new Error(`File type not allowed. Allowed types: ${this.allowedTypes.join(", ")}`);try{const t=await this.fileToBase64(e);return{id:this.generateId(),filename:e.name,url:t,type:e.type.startsWith("image/")?"image":"file",size:e.size,uploadedAt:(new Date).toISOString()}}catch(t){throw console.error("Base64 conversion failed:",t),new Error(`Failed to process file: ${e.name}`)}}fileToBase64(e){return new Promise((t,o)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=o,n.readAsDataURL(e)})}async uploadFiles(e){const t=e.map(e=>this.uploadFile(e));return Promise.all(t)}isImage(e){return e.type.startsWith("image/")}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}};class v{constructor(e){this.isVisible=!1,this.keydownHandler=null,this.imageElement=null,this.currentScale=1,this.minScale=.5,this.maxScale=3,this.imageUrl=e,this.element=this.createElement(),this.setupEventListeners()}createElement(){const e=document.createElement("div");e.className="uicm-image-modal",e.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100vw;\n      height: 100vh;\n      background: rgba(0, 0, 0, 0.9);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      opacity: 0;\n      visibility: hidden;\n      transition: opacity 0.3s ease, visibility 0.3s ease;\n      pointer-events: auto;\n    ";const t=document.createElement("div");t.className="uicm-image-container",t.style.cssText="\n      position: relative;\n      max-width: 80vw;\n      max-height: 80vh;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      pointer-events: auto;\n    ";const o=document.createElement("img");o.src=this.imageUrl,o.style.cssText="\n      max-width: 100%;\n      max-height: 100%;\n      object-fit: contain;\n      border-radius: 8px;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);\n      transition: transform 0.3s ease;\n      cursor: zoom-in;\n    ",this.imageElement=o;const n=document.createElement("button");n.className="uicm-image-close",n.innerHTML="×",n.style.cssText="\n      position: absolute;\n      top: -40px;\n      right: 0;\n      background: none;\n      border: none;\n      color: white;\n      font-size: 32px;\n      cursor: pointer;\n      width: 40px;\n      height: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 50%;\n      transition: background-color 0.2s ease;\n    ",n.addEventListener("mouseenter",()=>{n.style.backgroundColor="rgba(255, 255, 255, 0.1)"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="transparent"});const i=document.createElement("button");i.className="uicm-image-download",i.innerHTML="⬇",i.style.cssText="\n      position: absolute;\n      top: -40px;\n      right: 50px;\n      background: none;\n      border: none;\n      color: white;\n      font-size: 20px;\n      cursor: pointer;\n      width: 40px;\n      height: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 50%;\n      transition: background-color 0.2s ease;\n    ",i.addEventListener("mouseenter",()=>{i.style.backgroundColor="rgba(255, 255, 255, 0.1)"}),i.addEventListener("mouseleave",()=>{i.style.backgroundColor="transparent"}),i.addEventListener("click",e=>{e.stopPropagation(),this.downloadImage()});const s=document.createElement("button");s.className="uicm-image-zoom-in",s.innerHTML="🔍+",s.style.cssText="\n      position: absolute;\n      top: -40px;\n      right: 100px;\n      background: none;\n      border: none;\n      color: white;\n      font-size: 16px;\n      cursor: pointer;\n      width: 40px;\n      height: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 50%;\n      transition: background-color 0.2s ease;\n    ",s.addEventListener("mouseenter",()=>{s.style.backgroundColor="rgba(255, 255, 255, 0.1)"}),s.addEventListener("mouseleave",()=>{s.style.backgroundColor="transparent"}),s.addEventListener("click",e=>{e.stopPropagation(),this.zoomIn()});const a=document.createElement("button");a.className="uicm-image-zoom-out",a.innerHTML="🔍-",a.style.cssText="\n      position: absolute;\n      top: -40px;\n      right: 140px;\n      background: none;\n      border: none;\n      color: white;\n      font-size: 16px;\n      cursor: pointer;\n      width: 40px;\n      height: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 50%;\n      transition: background-color 0.2s ease;\n    ",a.addEventListener("mouseenter",()=>{a.style.backgroundColor="rgba(255, 255, 255, 0.1)"}),a.addEventListener("mouseleave",()=>{a.style.backgroundColor="transparent"}),a.addEventListener("click",e=>{e.stopPropagation(),this.zoomOut()});const r=document.createElement("button");return r.className="uicm-image-reset",r.innerHTML="🔄",r.style.cssText="\n      position: absolute;\n      top: -40px;\n      right: 180px;\n      background: none;\n      border: none;\n      color: white;\n      font-size: 16px;\n      cursor: pointer;\n      width: 40px;\n      height: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 50%;\n      transition: background-color 0.2s ease;\n    ",r.addEventListener("mouseenter",()=>{r.style.backgroundColor="rgba(255, 255, 255, 0.1)"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor="transparent"}),r.addEventListener("click",e=>{e.stopPropagation(),this.resetZoom()}),t.appendChild(o),t.appendChild(n),t.appendChild(i),t.appendChild(s),t.appendChild(a),t.appendChild(r),e.appendChild(t),e}setupEventListeners(){this.element.addEventListener("click",e=>{e.stopPropagation(),e.target===this.element&&this.hide()});const e=this.element.querySelector(".uicm-image-close");e&&e.addEventListener("click",e=>{e.stopPropagation(),this.hide()}),this.imageElement&&(this.imageElement.addEventListener("click",e=>{e.stopPropagation(),this.toggleZoom()}),this.imageElement.addEventListener("wheel",e=>{e.preventDefault(),e.stopPropagation(),e.deltaY<0?this.zoomIn():this.zoomOut()}))}downloadImage(){const e=document.createElement("a");e.href=this.imageUrl,e.download=`image-${Date.now()}.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}zoomIn(){this.imageElement&&this.currentScale<this.maxScale&&(this.currentScale=Math.min(this.maxScale,this.currentScale+.25),this.updateImageTransform(),this.updateCursor())}zoomOut(){this.imageElement&&this.currentScale>this.minScale&&(this.currentScale=Math.max(this.minScale,this.currentScale-.25),this.updateImageTransform(),this.updateCursor())}resetZoom(){this.imageElement&&(this.currentScale=1,this.updateImageTransform(),this.updateCursor())}toggleZoom(){1===this.currentScale?this.zoomIn():this.resetZoom()}updateImageTransform(){this.imageElement&&(this.imageElement.style.transform=`scale(${this.currentScale})`)}updateCursor(){this.imageElement&&(1===this.currentScale?this.imageElement.style.cursor="zoom-in":this.imageElement.style.cursor="zoom-out")}show(){this.isVisible||(document.body.appendChild(this.element),this.isVisible=!0,this.keydownHandler=e=>{"Escape"===e.key&&this.isVisible&&this.hide()},document.addEventListener("keydown",this.keydownHandler),document.body.style.overflow="hidden",requestAnimationFrame(()=>{this.element.style.opacity="1",this.element.style.visibility="visible",this.element.style.pointerEvents="auto"}))}hide(){this.isVisible&&(this.isVisible=!1,this.element.style.opacity="0",this.element.style.visibility="hidden",this.element.style.pointerEvents="none",this.keydownHandler&&(document.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=null),document.body.style.overflow="",setTimeout(()=>{this.element.parentNode&&this.element.parentNode.removeChild(this.element)},300))}destroy(){this.hide(),this.keydownHandler&&(document.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=null)}}class w{constructor(e){this.imageModal=null,this.handleOutsideClick=e=>{this.element.contains(e.target)||this.props.onClose()},this.props=e,this.element=this.createElement(),this.attachEventListeners()}detectAndFormatUrls(e){return e.replace(/(https?:\/\/[^\s]+)/g,e=>`<a href="${e}" target="_blank" rel="noopener noreferrer" class="uicm-url-link">${e}</a>`)}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}addFilePreview(e,t,o){if(t.childElementCount>=5)return;const n=document.createElement("div");if(n.className="uicm-file-preview-item",n.style.position="relative","image"===e.type){const t=document.createElement("img");t.className="uicm-file-preview-image",t.src=e.url,t.alt=e.filename,t.style.cursor="pointer",t.addEventListener("click",()=>{this.imageModal&&this.imageModal.destroy(),this.imageModal=new v(e.url),this.imageModal.show()}),n.appendChild(t)}else{const e=document.createElement("span");e.className="uicm-file-preview-icon",e.innerHTML="📎",n.appendChild(e)}const i=document.createElement("span");i.className="uicm-file-preview-size",i.textContent=this.formatFileSize(e.size),n.appendChild(i);const s=document.createElement("button");s.className="uicm-file-preview-remove",s.innerHTML="×",s.type="button",s.style.position="absolute",s.style.top="2px",s.style.right="2px",s.style.zIndex="2",s.onclick=()=>{n.remove(),o()},n.appendChild(s),t.appendChild(n)}createElement(){const e=document.createElement("div");e.className="uicm-comment-modal",e.style.position="absolute",e.style.zIndex="10000",document.body.appendChild(e);const t=u(e,this.props.position,{padding:20,preferredSide:"bottom"});e.style.left=`${t.x}px`,e.style.top=`${t.y}px`,document.body.removeChild(e);const o=document.createElement("div");o.className="uicm-modal-header-bar";const n=document.createElement("div");n.className="uicm-modal-header";const i=document.createElement("div");i.className="uicm-modal-header-content";const s=document.createElement("div");s.className="uicm-modal-top-section";const a=document.createElement("div");a.className="uicm-modal-title-section";const r=document.createElement("h3");r.className="uicm-modal-title",r.textContent="Comment";const l=document.createElement("p");l.className="uicm-modal-description",l.textContent="View and manage feedback",a.appendChild(r),a.appendChild(l);const c=document.createElement("button");c.className="uicm-close-button",c.innerHTML="×",c.title="Close",c.onclick=()=>this.props.onClose(),s.appendChild(a),s.appendChild(c);const m=document.createElement("div");m.className="uicm-modal-bottom-section";const d=this.props.comments[0],p=document.createElement("select");p.className="uicm-status-select",p.value=d.status,p.setAttribute("data-status",d.status);if([exports.CommentStatus.BUG,exports.CommentStatus.FEATURE_REQUEST,exports.CommentStatus.DEV_COMPLETED,exports.CommentStatus.DONE,exports.CommentStatus.ARCHIVED].forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e.toUpperCase(),t.selected=e===d.status,p.appendChild(t)}),p.addEventListener("change",async e=>{const t=e.target.value;t!==d.status&&(await this.props.onStatusChange(d.id,t),p.setAttribute("data-status",t))}),this.props.onDeleteComment){const e=document.createElement("button");e.className="uicm-delete-button",e.innerHTML="🗑️",e.title="Delete comment",e.addEventListener("click",async t=>{if(t.stopPropagation(),confirm("Are you sure you want to delete this comment and all its replies? This action cannot be undone."))try{e.disabled=!0,e.innerHTML="⏳",e.title="Deleting...",e.style.opacity="0.7",await this.props.onDeleteComment(d.id),this.props.onClose()}catch(t){console.error("Failed to delete comment:",t),e.disabled=!1,e.innerHTML="🗑️",e.title="Delete comment",e.style.opacity="1",alert("Failed to delete comment. Please try again.")}}),m.appendChild(p),m.appendChild(e)}else m.appendChild(p);i.appendChild(s),i.appendChild(m),n.appendChild(i);const h=document.createElement("div");h.className="uicm-comments-list",this.props.comments.forEach(e=>{const t=this.createCommentItem(e);h.appendChild(t)});const g=this.createReplyForm();return e.appendChild(o),e.appendChild(n),e.appendChild(h),e.appendChild(g),e}createCommentItem(e){const t=document.createElement("div");t.className="uicm-comment-item";const i=document.createElement("div");i.className="uicm-comment-avatar",e.createdBy.avatar?i.innerHTML=`<img src="${e.createdBy.avatar}" alt="${e.createdBy.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`:i.textContent=e.createdBy.name.charAt(0).toUpperCase();const s=document.createElement("div");s.className="uicm-comment-content";const a=document.createElement("div");a.className="uicm-comment-header";const r=document.createElement("span");r.className="uicm-author-name",r.textContent=e.createdBy.name;const l=document.createElement("span");l.className="uicm-role-badge",l.textContent=n(e.role);const c=o(e.role);l.style.backgroundColor=c.bg,l.style.color=c.text,l.style.borderColor=c.border;const m=document.createElement("span");m.className="uicm-comment-time",m.textContent=this.formatTimeAgo(e.createdAt),a.appendChild(r),a.appendChild(l),a.appendChild(m);const d=document.createElement("p");if(d.className="uicm-comment-text",d.innerHTML=this.detectAndFormatUrls(e.content),s.appendChild(a),s.appendChild(d),console.log("🔍 Checking attachments for comment:",e.id,e.attachments),e.attachments&&e.attachments.length>0){console.log("📎 Found attachments:",e.attachments.length);const t=document.createElement("div");t.className="uicm-comment-attachments";e.attachments.filter(e=>"image"===e.type).length>1&&t.classList.add("has-multiple-images"),e.attachments.forEach((e,o)=>{console.log(`📎 Processing attachment ${o}:`,e);const n=document.createElement("div");if(n.className="uicm-attachment-item","image"===e.type){const t=document.createElement("img");t.className="uicm-attachment-image",t.src=e.url,t.alt=e.filename,t.style.cursor="pointer",t.addEventListener("click",()=>{this.imageModal&&this.imageModal.destroy(),this.imageModal=new v(e.url),this.imageModal.show()}),n.appendChild(t)}else{const t=document.createElement("span");t.className="uicm-attachment-icon",t.innerHTML="📎";const o=document.createElement("div");o.className="uicm-attachment-info";const i=document.createElement("span");i.className="uicm-attachment-name",i.textContent=e.filename;const s=document.createElement("span");s.className="uicm-attachment-size",s.textContent=this.formatFileSize(e.size),o.appendChild(i),o.appendChild(s),n.appendChild(t),n.appendChild(o),n.style.cursor="pointer",n.addEventListener("click",()=>{window.open(e.url,"_blank")})}t.appendChild(n),console.log(`✅ Attachment ${o} added to container`)}),s.appendChild(t),console.log("✅ Attachments container added to comment item")}return t.appendChild(i),t.appendChild(s),t}createReplyForm(){const e=document.createElement("div");e.className="uicm-reply-form";const t=document.createElement("div");t.className="uicm-reply-header";const o=document.createElement("div");o.className="uicm-reply-avatar",this.props.currentUser.avatar?o.innerHTML=`<img src="${this.props.currentUser.avatar}" alt="${this.props.currentUser.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`:o.textContent=this.props.currentUser.name.charAt(0).toUpperCase();const n=document.createElement("input");n.className="uicm-reply-user-name-input",n.type="text",n.value=this.props.currentUser.name,n.placeholder="Your name",n.addEventListener("input",()=>{n.value.trim()?o.textContent=n.value.trim().charAt(0).toUpperCase():o.textContent=this.props.currentUser.name.charAt(0).toUpperCase()}),t.appendChild(o),t.appendChild(n);const i=document.createElement("div");i.className="uicm-reply-input-container";const s=document.createElement("textarea");s.className="uicm-reply-input",s.placeholder="Write a reply...",s.rows=2;const a=document.createElement("div");a.className="uicm-file-upload-section";const r=document.createElement("input");r.type="file",r.className="uicm-file-input",r.style.display="none",r.accept="image/*,application/pdf,.doc,.docx,.txt,.zip,.rar",r.multiple=!0;const l=document.createElement("button");l.className="uicm-file-upload-button",l.type="button",l.innerHTML="📎 Attach Files",l.onclick=()=>r.click();const c=document.createElement("div");c.className="uicm-file-preview-container";let m=[];r.addEventListener("change",async e=>{const t=e.target.files;if(t){for(const e of Array.from(t))try{const t=await y.uploadFile(e);m.push(t),this.addFilePreview(t,c,()=>{m=m.filter(e=>e.id!==t.id),d()})}catch(t){console.error("Failed to upload file:",t);const o=t instanceof Error?t.message:"Unknown error";alert(`Failed to upload ${e.name}: ${o}`)}d()}});const d=()=>{const e=s.value.trim().length>0,t=n.value.trim().length>0,o=m.length>0;h.disabled=!e&&!o||!t||s.value.length>500};a.appendChild(r),a.appendChild(l),a.appendChild(c);const p=document.createElement("div");p.className="uicm-reply-char-counter";const u=document.createElement("div");u.className="uicm-reply-actions";const h=document.createElement("button");h.className="uicm-reply-send",h.textContent="Reply",h.disabled=!0,u.appendChild(h),i.appendChild(s),i.appendChild(a),i.appendChild(p),i.appendChild(u),s.addEventListener("input",()=>{const e=s.value.length;p.textContent=`${e} / 500`,d(),e>400?p.classList.add("uicm-warning"):p.classList.remove("uicm-warning"),e>500?p.classList.add("uicm-error"):p.classList.remove("uicm-error"),s.style.height="auto",s.style.height=Math.min(s.scrollHeight,120)+"px"}),s.addEventListener("paste",async e=>{const t=e.clipboardData?.items;if(t)for(let o=0;o<t.length;o++){const n=t[o];if(-1!==n.type.indexOf("image")){e.preventDefault();const t=n.getAsFile();if(t){const e=s.placeholder;s.placeholder="🔄 Processing image...",s.disabled=!0;const o=document.createElement("div");o.className="uicm-paste-loading",o.innerHTML=`\n                <div class="uicm-loading-spinner"></div>\n                <span>Processing image: ${t.name}</span>\n              `,o.style.cssText="\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background: rgba(255, 255, 255, 0.95);\n                backdrop-filter: blur(10px);\n                border: 1px solid rgba(59, 130, 246, 0.2);\n                border-radius: 12px;\n                padding: 16px 24px;\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                font-size: 14px;\n                color: #1e293b;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n                z-index: 1000;\n              ";o.querySelector(".uicm-loading-spinner").style.cssText="\n                width: 20px;\n                height: 20px;\n                border: 2px solid #e2e8f0;\n                border-top: 2px solid #3b82f6;\n                border-radius: 50%;\n                animation: uicm-spin 1s linear infinite;\n              ",this.element.appendChild(o);try{const e=await y.uploadFile(t);m.push(e),this.addFilePreview(e,c,()=>{m=m.filter(t=>t.id!==e.id),d()}),d(),console.log("📸 Image pasted and uploaded in reply:",e.filename),o.innerHTML='\n                  <span style="color: #10b981;">✅</span>\n                  <span>Image uploaded successfully!</span>\n                ',setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},1e3)}catch(e){console.error("Failed to paste image in reply:",e);const t=e instanceof Error?e.message:"Unknown error";o.innerHTML=`\n                  <span style="color: #ef4444;">❌</span>\n                  <span>Failed to upload: ${t}</span>\n                `,setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},3e3)}finally{s.placeholder=e,s.disabled=!1,s.focus()}}}}}),n.addEventListener("input",()=>{d()});const g=async()=>{const e=s.value.trim(),t=n.value.trim(),o=e.length>0,i=m.length>0;if((o||i)&&t&&0!==this.props.comments.length)try{h.disabled=!0,h.textContent="Sending...";const o=t!==this.props.currentUser.name?{...this.props.currentUser,name:t}:this.props.currentUser;console.log("📤 Sending reply with attachments:",m.length),await this.props.onAddReply(this.props.comments[0].id,e,o,m.length>0?m:void 0),s.value="",p.textContent="0 / 500",p.classList.remove("uicm-warning","uicm-error"),s.style.height="auto",m=[],c.innerHTML="",r.value="",console.log("🔄 Force refreshing modal after reply"),setTimeout(()=>{const e=new CustomEvent("uicm-reply-added",{detail:{commentId:this.props.comments[0].id}});document.dispatchEvent(e)},100),console.log("✅ Reply sent successfully")}catch(e){console.error("Failed to send reply:",e)}finally{h.disabled=!1,h.textContent="Reply"}};return h.onclick=g,s.addEventListener("keydown",e=>{!e.ctrlKey&&!e.metaKey||"Enter"!==e.key||h.disabled||(e.preventDefault(),g())}),e.appendChild(t),e.appendChild(i),e}updateComments(e){console.log("🔄 Updating modal comments:",e.length),e.forEach((e,t)=>{console.log(`📝 Comment ${t}:`,{id:e.id,content:e.content.substring(0,50)+"...",attachments:e.attachments?.length||0,attachmentDetails:e.attachments?.map(e=>({type:e.type,filename:e.filename,size:e.size}))||[]})});const t=this.props.comments.length;this.props.comments=e,this.refreshCommentsList();const o=this.element.querySelector(".uicm-comment-count");o&&(o.textContent=`${e.length} comment${1!==e.length?"s":""}`);const n=this.element.querySelector(".uicm-comments-list");if(n&&(n.scrollTop=n.scrollHeight,e.length>t)){const e=n.querySelectorAll(".uicm-comment-item"),t=e[e.length-1];t&&(t.style.backgroundColor="rgba(34, 197, 94, 0.1)",t.style.transition="background-color 0.3s ease",setTimeout(()=>{t.style.backgroundColor=""},1e3))}console.log("✅ Modal updated with new comments:",e.length)}updateUser(e){this.props.currentUser=e,console.log("🔄 CommentModal: User updated:",e.name),this.refreshCommentsList()}refreshCommentsList(){console.log("🔄 Refreshing comments list");const e=this.element.querySelector(".uicm-comments-list");e&&(e.innerHTML="",this.props.comments.forEach(t=>{console.log("📝 Creating comment item for:",t.id);const o=this.createCommentItem(t);e.appendChild(o)}),console.log("✅ Comments list refreshed"))}formatTimeAgo(e){const t=new Date(e),o=new Date,n=Math.floor((o.getTime()-t.getTime())/1e3);return n<60?"just now":n<3600?`${Math.floor(n/60)}m ago`:n<86400?`${Math.floor(n/3600)}h ago`:`${Math.floor(n/86400)}d ago`}attachEventListeners(){this.element.addEventListener("click",e=>{e.stopPropagation(),console.log("🔒 Modal internal click - prevented propagation")}),this.element.addEventListener("mousedown",e=>{e.stopPropagation()}),this.element.addEventListener("mouseup",e=>{e.stopPropagation()}),this.element.addEventListener("keydown",e=>{e.stopPropagation()}),this.element.addEventListener("keyup",e=>{e.stopPropagation()}),setTimeout(()=>{document.addEventListener("click",this.handleOutsideClick)},0)}getElement(){return this.element}reposition(){h(this.element,{padding:100,preferredSide:"bottom"})}destroy(){this.imageModal&&(this.imageModal.destroy(),this.imageModal=null),document.removeEventListener("click",this.handleOutsideClick),this.element.remove()}}class C{constructor(e){this.modal=null,this.imageModal=null,this.handleClick=e=>{console.log("🔵 CommentBubble clicked!",this.props.comment.id),console.log("🔵 Click event details:",{target:e.target,currentTarget:e.currentTarget,type:e.type,bubbles:e.bubbles,cancelable:e.cancelable,eventPhase:e.eventPhase,isTrusted:e.isTrusted}),console.log("🔵 Bubble element state:",{element:this.element,parent:this.element.parentElement,parentDisplay:this.element.parentElement?.style.display,rect:this.element.getBoundingClientRect()}),e.stopPropagation(),e.preventDefault();const t=e,o={x:t.clientX||this.props.position.x,y:t.clientY||this.props.position.y};console.log("🔄 About to show modal at click position:",o),this.showModal(o)},console.log("🔧 Creating CommentBubble:",e.comment.id),this.props=e,this.element=this.createElement(),console.log("📦 Element created:",this.element),this.attachEventListeners(),console.log("🎯 Event listeners attached"),document.addEventListener("click",e=>{(e.target===this.element||this.element.contains(e.target))&&(console.log("🎯 Global click detected on bubble:",this.props.comment.id),console.log("🎯 Click target:",e.target),console.log("🎯 Bubble element:",this.element))})}checkBubbleVisibility(){const e=this.element.getBoundingClientRect(),t=e.left+e.width/2,o=e.top+e.height/2,n=document.elementFromPoint(t,o);console.log("👁️ Bubble visibility check:",{commentId:this.props.comment.id,rect:e,centerPoint:{x:t,y:o},elementAtPoint:n,isOwnElement:n===this.element,isVisible:e.width>0&&e.height>0,computedStyle:{display:getComputedStyle(this.element).display,visibility:getComputedStyle(this.element).visibility,opacity:getComputedStyle(this.element).opacity,pointerEvents:getComputedStyle(this.element).pointerEvents,zIndex:getComputedStyle(this.element).zIndex}})}testBubbleClickability(){const e=this.element.getBoundingClientRect(),t=e.left+e.width/2,o=e.top+e.height/2,n=document.elementFromPoint(t,o);console.log("🧪 BUBBLE CLICKABILITY TEST:",{commentId:this.props.comment.id,bubbleElement:this.element,elementRect:e,elementAtCenter:n,isClickable:n===this.element,parentElement:this.element.parentElement,parentDisplay:this.element.parentElement?.style.display,parentComputedDisplay:this.element.parentElement?getComputedStyle(this.element.parentElement).display:null,bubbleStyles:{display:getComputedStyle(this.element).display,visibility:getComputedStyle(this.element).visibility,opacity:getComputedStyle(this.element).opacity,pointerEvents:getComputedStyle(this.element).pointerEvents,zIndex:getComputedStyle(this.element).zIndex,position:getComputedStyle(this.element).position}}),console.log("🔄 Attempting programmatic click..."),this.element.click()}getStatusColor(){switch(this.props.comment.status){case exports.CommentStatus.BUG:return{bg:"#dc3545",border:"#c82333",text:"white"};case exports.CommentStatus.FEATURE_REQUEST:return{bg:"#ffc107",border:"#e0a800",text:"black"};case exports.CommentStatus.DEV_COMPLETED:return{bg:"#3b82f6",border:"#2066b3",text:"white"};case exports.CommentStatus.DONE:return{bg:"#28a745",border:"#1e7e34",text:"white"};case exports.CommentStatus.ARCHIVED:return{bg:"#6c757d",border:"#545b62",text:"white"};default:return{bg:"#007bff",border:"#0056b3",text:"white"}}}createElement(){const e=document.createElement("div");e.className="uicm-comment-bubble",e.style.position="absolute",e.style.left=`${this.props.position.x}px`,e.style.top=`${this.props.position.y}px`,e.style.width="32px",e.style.height="32px",e.style.borderRadius="50%";const t=this.getStatusColor();e.style.backgroundColor=t.bg,e.style.border=`2px solid ${t.border}`,e.style.color=t.text,e.style.cursor="pointer",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.fontSize="16px",e.style.fontWeight="bold",e.style.zIndex="100",e.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.2)",e.style.transition="all 0.2s ease",e.style.position="relative",e.innerHTML="💬";const n=1+(this.props.comment.replies?.length||0),i=document.createElement("div");i.className="uicm-comment-count-badge",i.textContent=n.toString(),i.style.cssText=`\n      position: absolute;\n      top: -6px;\n      right: -6px;\n      background: ${t.bg};\n      color: ${t.text};\n      border: 2px solid ${t.border};\n      border-radius: 50%;\n      width: 18px;\n      height: 18px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 10px;\n      font-weight: bold;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n      z-index: 101;\n    `,e.appendChild(i);const s=o(this.props.comment.role);e.title=`Status: ${this.props.comment.status.toUpperCase()} | Role: ${this.props.comment.role.toUpperCase()} | Comments: ${n}`;const a=document.createElement("div");return a.className="uicm-role-indicator",a.style.cssText=`\n      position: absolute;\n      bottom: -2px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 8px;\n      height: 8px;\n      border-radius: 50%;\n      background: ${s.border};\n      border: 1px solid white;\n      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\n      z-index: 102;\n    `,e.appendChild(a),console.log("💬 Chat bubble element created:",{className:e.className,position:{x:this.props.position.x,y:this.props.position.y},status:this.props.comment.status,colors:t,commentCount:n}),e}attachEventListeners(){console.log("🔗 Attaching event listeners to bubble"),this.element.addEventListener("click",this.handleClick),console.log("✅ Click listener attached"),this.element.addEventListener("mouseenter",()=>{console.log("🐭 Mouse enter bubble"),this.element.style.transform="scale(1.1)"}),this.element.addEventListener("mouseleave",()=>{console.log("🐭 Mouse leave bubble"),this.element.style.transform="scale(1)"}),document.addEventListener("uicm-reply-added",e=>{if(e.detail.commentId===this.props.comment.id&&this.modal){console.log("🔄 Reply added event received, refreshing modal");const e=[this.props.comment,...this.props.comment.replies];this.modal.updateComments(e)}})}showModal(e){console.log("🔄 Creating modal for comment:",this.props.comment.id),this.modal&&(console.log("🗑️ Destroying existing modal"),this.modal.destroy(),this.modal=null);const t=[this.props.comment,...this.props.comment.replies];console.log("📝 Modal comments:",t.length);const o={x:e.x+30,y:e.y};this.modal=new w({comments:t,currentUser:this.props.currentUser,position:o,onClose:()=>{console.log("❌ Modal closed"),this.modal&&(this.modal.destroy(),this.modal=null)},onAddReply:async(e,t,o,n)=>{if(console.log("💬 Adding reply:",e,t,o?.name,"attachments:",n?.length||0),await this.props.onReply(e,t,o,n),this.modal){const e=[this.props.comment,...this.props.comment.replies];this.modal.updateComments(e)}const i=1+(this.props.comment.replies?.length||0),s=this.element.querySelector(".uicm-comment-count-badge");s&&(s.textContent=i.toString()),this.element.title=`Status: ${this.props.comment.status.toUpperCase()} | Comments: ${i}`},onStatusChange:async(e,t)=>{console.log("🔄 Changing status:",e,t),await this.props.onStatusChange(e,t),this.updateBubbleAppearance()},onDeleteComment:async e=>{console.log("🗑️ Deleting comment:",e),await this.props.onDelete(e),this.updateBubbleAppearance(),e===this.props.comment.id&&this.modal&&(this.modal.destroy(),this.modal=null)}}),console.log("✅ Modal created, using CommentManager to show"),this.props.onShowModal(this.modal);const n=document.getElementById("uicm-interaction-layer");n&&(n.appendChild(this.modal.getElement()),this.modal.reposition(),console.log("🎯 Modal appended to interaction layer"))}updateComment(e){if(console.log("🔄 CommentBubble.updateComment called:",{commentId:e.id,oldRepliesCount:this.props.comment.replies?.length||0,newRepliesCount:e.replies?.length||0,modalExists:!!this.modal}),this.props.comment=e,this.updateBubbleAppearance(),this.modal){console.log("🔄 Updating modal with new comment data");const e=[this.props.comment,...this.props.comment.replies];this.modal.updateComments(e)}}updateUser(e){this.props.currentUser=e,console.log("🔄 CommentBubble: User updated:",e.name),this.modal&&this.modal.updateUser(e)}updateBubbleAppearance(){const e=this.getStatusColor();this.element.style.backgroundColor=e.bg,this.element.style.border=`2px solid ${e.border}`,this.element.style.color=e.text;const t=1+(this.props.comment.replies?.length||0),n=this.element.querySelector(".uicm-comment-count-badge");n&&(n.textContent=t.toString(),n.style.background=e.bg,n.style.color=e.text,n.style.borderColor=e.border);const i=this.element.querySelector(".uicm-role-indicator");if(i){const e=o(this.props.comment.role);i.style.background=e.border}this.element.title=`Status: ${this.props.comment.status.toUpperCase()} | Role: ${this.props.comment.role.toUpperCase()} | Comments: ${t}`,console.log("💬 Chat bubble appearance updated:",{status:this.props.comment.status,role:this.props.comment.role,colors:e,commentCount:t})}updatePosition(e){this.props.position=e,this.element.style.left=`${e.x}px`,this.element.style.top=`${e.y}px`}getElement(){return this.element}destroy(){this.modal&&this.modal.destroy(),this.element.removeEventListener("click",this.handleClick),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}testClickability(){console.log("🧪 TESTING BUBBLE CLICKABILITY for:",this.props.comment.id),this.testBubbleClickability()}}class E{constructor(e){this.isSubmitting=!1,this.selectedAttachments=[],this.imageModal=null,this.props=e,this.element=this.createElement(),this.setupEventListeners()}addFilePreview(e,t,o){if(t.childElementCount>=5)return;const n=document.createElement("div");if(n.className="uicm-file-preview-item",n.style.position="relative","image"===e.type){const t=document.createElement("img");t.className="uicm-file-preview-image",t.src=e.url,t.alt=e.filename,t.style.cursor="pointer",t.addEventListener("click",()=>{this.imageModal&&this.imageModal.destroy(),this.imageModal=new v(e.url),this.imageModal.show()}),n.appendChild(t)}else{const e=document.createElement("span");e.className="uicm-file-preview-icon",e.innerHTML="📎",n.appendChild(e)}const i=document.createElement("span");i.className="uicm-file-preview-size",i.textContent=this.formatFileSize(e.size),n.appendChild(i);const s=document.createElement("button");s.className="uicm-file-preview-remove",s.innerHTML="×",s.type="button",s.style.position="absolute",s.style.top="2px",s.style.right="2px",s.style.zIndex="2",s.onclick=()=>{n.remove(),o()},n.appendChild(s),t.appendChild(n)}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}createElement(){const e=document.createElement("div");e.className="uicm-comment-form",e.style.position="absolute",e.style.zIndex="10000",document.body.appendChild(e);const t=u(e,this.props.position,{padding:20,preferredSide:"bottom"});e.style.left=`${t.x}px`,e.style.top=`${t.y}px`,document.body.removeChild(e);const o=document.createElement("div");o.className="uicm-form-header";const n=document.createElement("div");n.className="uicm-form-header-content";const i=document.createElement("div");i.className="uicm-form-title-section";const s=document.createElement("h2");s.className="uicm-form-title",s.textContent="Add Comment";const a=document.createElement("p");a.className="uicm-form-subtitle",a.textContent="Share your thoughts or feedback",i.appendChild(s),i.appendChild(a);const r=document.createElement("div");r.className="uicm-form-action-section";const l=document.createElement("button");l.className="uicm-close-button",l.innerHTML="×",l.setAttribute("aria-label","Close comment form"),l.title="Close",l.onclick=e=>{e.preventDefault(),e.stopPropagation(),this.props.onCancel()},r.appendChild(l),n.appendChild(i),n.appendChild(r),o.appendChild(n);const c=document.createElement("div");c.className="uicm-form-content";const m=document.createElement("div");m.className="uicm-user-info";const d=document.createElement("div");d.className="uicm-user-avatar",d.textContent=this.props.currentUser.name.charAt(0).toUpperCase(),this.props.currentUser.avatar&&(d.style.backgroundImage=`url(${this.props.currentUser.avatar})`,d.style.backgroundSize="cover",d.textContent=""),this.avatar=d;const p=document.createElement("div");p.className="uicm-user-details",this.nameInput=document.createElement("input"),this.nameInput.type="text",this.nameInput.className="uicm-user-name-input",this.nameInput.value=this.props.currentUser.name,this.nameInput.placeholder="Your name",this.nameInput.maxLength=50,p.appendChild(this.nameInput),m.appendChild(d),m.appendChild(p),this.textarea=document.createElement("textarea"),this.textarea.placeholder="Write a comment...",this.textarea.className="uicm-comment-textarea",this.textarea.rows=3;const h=document.createElement("div");h.className="uicm-file-upload-section";const g=document.createElement("input");g.type="file",g.className="uicm-file-input",g.style.display="none",g.accept="image/*,application/pdf,.doc,.docx,.txt,.zip,.rar",g.multiple=!0;const b=document.createElement("button");b.className="uicm-file-upload-button",b.type="button",b.innerHTML="📎 Attach Files",b.onclick=()=>g.click();const f=document.createElement("div");f.className="uicm-file-preview-container",g.addEventListener("change",async e=>{const t=e.target.files;if(t){for(const e of Array.from(t))try{const t=await y.uploadFile(e);this.selectedAttachments.push(t),this.addFilePreview(t,f,()=>{this.selectedAttachments=this.selectedAttachments.filter(e=>e.id!==t.id),this.updateSubmitButton()})}catch(t){console.error("Failed to upload file:",t);const o=t instanceof Error?t.message:"Unknown error";alert(`Failed to upload ${e.name}: ${o}`)}this.updateSubmitButton()}}),h.appendChild(g),h.appendChild(b),h.appendChild(f),this.charCounter=document.createElement("div"),this.charCounter.className="uicm-char-counter",this.charCounter.textContent="0 / 1000";const x=document.createElement("div");x.className="uicm-form-actions";const v=document.createElement("div");v.className="uicm-secondary-actions";const w=document.createElement("button");w.className="uicm-emoji-button",w.innerHTML="😊",w.setAttribute("aria-label","Add emoji"),w.type="button";const C=document.createElement("button");C.className="uicm-mention-button",C.innerHTML="@",C.setAttribute("aria-label","Mention someone"),C.type="button",v.appendChild(w),v.appendChild(C);const E=document.createElement("div");return E.className="uicm-primary-actions",this.submitButton=document.createElement("button"),this.submitButton.className="uicm-submit-button",this.submitButton.type="button",this.updateSubmitButton(),E.appendChild(this.submitButton),x.appendChild(v),x.appendChild(E),c.appendChild(m),c.appendChild(this.textarea),c.appendChild(this.charCounter),c.appendChild(h),c.appendChild(x),e.appendChild(o),e.appendChild(c),e}setupEventListeners(){this.element.addEventListener("click",e=>{e.stopPropagation(),console.log("🔒 Form internal click - prevented propagation")}),this.element.addEventListener("mousedown",e=>{e.stopPropagation()}),this.element.addEventListener("mouseup",e=>{e.stopPropagation()}),this.element.addEventListener("keydown",e=>{e.stopPropagation()}),this.element.addEventListener("keyup",e=>{e.stopPropagation()}),this.textarea.addEventListener("input",()=>{this.textarea.style.height="auto",this.textarea.style.height=Math.min(this.textarea.scrollHeight,200)+"px",this.updateCharCounter(),this.updateSubmitButton()}),this.textarea.addEventListener("paste",async e=>{const t=e.clipboardData?.items;if(t)for(let o=0;o<t.length;o++){const n=t[o];if(-1!==n.type.indexOf("image")){e.preventDefault();const t=n.getAsFile();if(t){const e=this.textarea.placeholder;this.textarea.placeholder="🔄 Processing image...",this.textarea.disabled=!0;const o=document.createElement("div");o.className="uicm-paste-loading",o.innerHTML=`\n                <div class="uicm-loading-spinner"></div>\n                <span>Processing image: ${t.name}</span>\n              `,o.style.cssText="\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background: rgba(255, 255, 255, 0.95);\n                backdrop-filter: blur(10px);\n                border: 1px solid rgba(59, 130, 246, 0.2);\n                border-radius: 12px;\n                padding: 16px 24px;\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                font-size: 14px;\n                color: #1e293b;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n                z-index: 1000;\n              ";o.querySelector(".uicm-loading-spinner").style.cssText="\n                width: 20px;\n                height: 20px;\n                border: 2px solid #e2e8f0;\n                border-top: 2px solid #3b82f6;\n                border-radius: 50%;\n                animation: uicm-spin 1s linear infinite;\n              ",this.element.appendChild(o);try{const e=await y.uploadFile(t);this.selectedAttachments.push(e);const n=this.element.querySelector(".uicm-file-preview-container");n&&this.addFilePreview(e,n,()=>{this.selectedAttachments=this.selectedAttachments.filter(t=>t.id!==e.id),this.updateSubmitButton()}),this.updateSubmitButton(),console.log("📸 Image pasted and uploaded:",e.filename),o.innerHTML='\n                  <span style="color: #10b981;">✅</span>\n                  <span>Image uploaded successfully!</span>\n                ',setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},1e3)}catch(e){console.error("Failed to paste image:",e);const t=e instanceof Error?e.message:"Unknown error";o.innerHTML=`\n                  <span style="color: #ef4444;">❌</span>\n                  <span>Failed to upload: ${t}</span>\n                `,setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},3e3)}finally{this.textarea.placeholder=e,this.textarea.disabled=!1,this.textarea.focus()}}}}}),this.nameInput.addEventListener("input",()=>{this.avatar&&this.nameInput.value.trim()&&(this.avatar.textContent=this.nameInput.value.trim().charAt(0).toUpperCase()),this.updateSubmitButton()}),this.textarea.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),this.handleSubmit())}),requestAnimationFrame(()=>{this.textarea.focus()}),this.submitButton.onclick=async e=>{e.preventDefault(),e.stopPropagation(),await this.handleSubmit()}}updateCharCounter(){const e=this.textarea.value.length,t=1e3;this.charCounter.textContent=`${e} / 1000`,e>800?this.charCounter.classList.add("uicm-warning"):this.charCounter.classList.remove("uicm-warning"),e>t?this.charCounter.classList.add("uicm-error"):this.charCounter.classList.remove("uicm-error")}updateSubmitButton(){const e=this.textarea.value.trim(),t=this.nameInput.value.trim(),o=e.length>0,n=this.selectedAttachments.length>0,i=(o||n)&&t.length>0&&e.length<=1e3;if(this.submitButton.disabled=!i||this.isSubmitting,this.isSubmitting)this.submitButton.innerHTML='\n        <div class="uicm-spinner"></div>\n        <span>Posting...</span>\n      ';else{const e=navigator.platform.includes("Mac")?"⌘":"Ctrl";this.submitButton.innerHTML=`\n        <span>Post Comment</span>\n        <kbd>${e} + Enter</kbd>\n      `}}async handleSubmit(){const e=this.textarea.value.trim(),t=this.nameInput.value.trim(),o=e.length>0,n=this.selectedAttachments.length>0;if((o||n)&&t&&!(e.length>1e3)){this.isSubmitting=!0,this.updateSubmitButton();try{await this.props.onSubmit(e,t,this.selectedAttachments.length>0?this.selectedAttachments:void 0),this.textarea.value="",this.selectedAttachments=[];const o=this.element.querySelector(".uicm-file-preview-container");o&&(o.innerHTML="");const n=this.element.querySelector(".uicm-file-input");n&&(n.value=""),this.updateCharCounter(),this.updateSubmitButton()}catch(e){console.error("Failed to submit comment:",e),this.showError("Failed to post comment. Please try again.")}finally{this.isSubmitting=!1,this.updateSubmitButton()}}}showError(e){const t=this.element.querySelector(".uicm-error-message");t&&t.remove();const o=document.createElement("div");o.className="uicm-error-message",o.textContent=e;const n=this.element.querySelector(".uicm-form-actions");n&&n.parentNode?.insertBefore(o,n),setTimeout(()=>{o.remove()},5e3)}getElement(){return this.element}reposition(){h(this.element,{padding:100,preferredSide:"bottom"})}destroy(){this.imageModal&&(this.imageModal.destroy(),this.imageModal=null),this.element.remove()}}class S{constructor(e,t={}){this.isTracking=!1,this.startTouch=null,this.lastTouch=null,this.SWIPE_THRESHOLD=50,this.SWIPE_TIMEOUT=500,this.TAP_TIMEOUT=300,this.LONG_PRESS_TIMEOUT=500,this.longPressTimer=null,this.tapTimer=null,this.handleTouchStart=e=>{if(1===e.touches.length){const t=e.touches[0];this.startTouch=this.createTouchEventData(t,e.target),this.lastTouch=this.startTouch,this.isTracking=!0,this.longPressTimer=window.setTimeout(()=>{this.isTracking&&this.startTouch&&this.onLongPress&&this.onLongPress(this.startTouch)},this.LONG_PRESS_TIMEOUT)}else 2===e.touches.length&&this.onPinch&&this.handlePinchStart(e)},this.handleTouchMove=e=>{if(this.isTracking)if(1===e.touches.length){const t=e.touches[0];this.lastTouch=this.createTouchEventData(t,e.target),this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),e.preventDefault()}else 2===e.touches.length&&this.onPinch&&this.handlePinchMove(e)},this.handleTouchEnd=e=>{if(!this.isTracking||!this.startTouch||!this.lastTouch)return;this.isTracking=!1,this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null);const t=this.lastTouch.timestamp-this.startTouch.timestamp,o=this.getDistance(this.startTouch,this.lastTouch);if(o<this.SWIPE_THRESHOLD&&t<this.TAP_TIMEOUT)this.onTap&&this.onTap(this.startTouch);else if(o>=this.SWIPE_THRESHOLD&&t<this.SWIPE_TIMEOUT&&this.onSwipe){const e={direction:this.getSwipeDirection(this.startTouch,this.lastTouch),distance:o,duration:t,startPoint:this.startTouch,endPoint:this.lastTouch};this.onSwipe(e)}this.startTouch=null,this.lastTouch=null},this.handleTouchCancel=()=>{this.isTracking=!1,this.startTouch=null,this.lastTouch=null,this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null)},this.element=e,this.onSwipe=t.onSwipe,this.onTap=t.onTap,this.onLongPress=t.onLongPress,this.onPinch=t.onPinch,this.attachEventListeners()}attachEventListeners(){this.element.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.element.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.element.addEventListener("touchend",this.handleTouchEnd,{passive:!1}),this.element.addEventListener("touchcancel",this.handleTouchCancel,{passive:!1})}handlePinchStart(e){e.preventDefault()}handlePinchMove(e){e.preventDefault()}createTouchEventData(e,t){return{x:e.clientX,y:e.clientY,timestamp:Date.now(),target:t}}getDistance(e,t){const o=t.x-e.x,n=t.y-e.y;return Math.sqrt(o*o+n*n)}getSwipeDirection(e,t){const o=t.x-e.x,n=t.y-e.y;return Math.abs(o)>Math.abs(n)?o>0?"right":"left":n>0?"down":"up"}destroy(){this.element.removeEventListener("touchstart",this.handleTouchStart),this.element.removeEventListener("touchmove",this.handleTouchMove),this.element.removeEventListener("touchend",this.handleTouchEnd),this.element.removeEventListener("touchcancel",this.handleTouchCancel),this.longPressTimer&&clearTimeout(this.longPressTimer),this.tapTimer&&clearTimeout(this.tapTimer)}}function k(e,t){let o=0,n=null;return(...i)=>{const s=Date.now();s-o>=t?(o=s,n&&(clearTimeout(n),n=null),e(...i)):n||(n=window.setTimeout(()=>{o=Date.now(),n=null,e(...i)},t-(s-o)))}}class T{constructor(e={}){this.callbacks=new Map,this.observer=new IntersectionObserver(e=>{e.forEach(e=>{const t=this.callbacks.get(e.target);t&&t(e.isIntersecting)})},e)}observe(e,t){this.callbacks.set(e,t),this.observer.observe(e)}unobserve(e){this.callbacks.delete(e),this.observer.unobserve(e)}disconnect(){this.callbacks.clear(),this.observer.disconnect()}}class L{constructor(){this.queue=[],this.isProcessing=!1}add(e){this.queue.push(e),this.isProcessing||this.process()}process(){0!==this.queue.length?(this.isProcessing=!0,requestAnimationFrame(()=>{this.queue.splice(0).forEach(e=>e()),this.process()})):this.isProcessing=!1}}class N{constructor(e=100){this.cache=new Map,this.maxSize=e}get(e){const t=this.cache.get(e);return void 0!==t&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;void 0!==e&&this.cache.delete(e)}this.cache.set(e,t)}clear(){this.cache.clear()}}function z(e){if(""!==e.id)return`//*[@id="${e.id}"]`;if(e===document.body)return"/html/body";let t=0;const o=e.parentNode?.childNodes||[];for(let n=0;n<o.length;n++){const i=o[n];if(i===e){const o=e.tagName.toLowerCase(),n=e.parentElement;if(n){return`${z(n)}/${o}[${t+1}]`}return`/${o}[${t+1}]`}1===i.nodeType&&i.tagName===e.tagName&&t++}throw new Error("Unable to generate XPath for element")}function M(e){try{return document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(t){return console.warn("Failed to resolve XPath:",e,t),null}}function U(e){const t=e;return e.isConnected&&null!==t.offsetParent&&"none"!==getComputedStyle(e).display&&"hidden"!==getComputedStyle(e).visibility}class P{constructor(e,t){this.comments=[],this.commentBubbles=new Map,this.activeForm=null,this.activeModal=null,this.activeOverlay=null,this.mode="normal",this.mutationTimeout=void 0,this.escKeyHandler=null,this.throttledUpdatePositions=k(()=>{this.updateBubblePositions()},100),this.rafUpdatePositions=function(e){let t=null;return(...o)=>{t||(t=requestAnimationFrame(()=>{t=null,e(...o)}))}}(()=>{this.updateBubblePositions()}),this.touchGestureRecognizer=null,this.debouncedUpdatePositions=f(()=>{this.updateBubblePositions()},100),this.handleElementClick=e=>{if(console.log("🔍 handleElementClick called",{mode:this.mode,target:e.target,currentTarget:e.currentTarget,targetElement:e.target?.tagName,targetClass:e.target?.className}),"comment"!==this.mode)return void console.log("❌ Not in comment mode, ignoring click");if(window.uicmIsNavigatingFromSidebar)return void console.log("🔒 Navigating from sidebar, preventing form opening");const t=e,o=e.target;if(o.classList.contains("uicm-comment-bubble")||o.closest(".uicm-comment-bubble"))return void console.log("🔵 Click on bubble, letting bubble handle it");const n=document.querySelector(".uicm-comment-form");if(n&&n.contains(o))return void console.log("❌ Click inside form layer, ignoring");console.log("🎯 Processing element click for new comment...");const i=document.querySelectorAll("[data-uicm-element]"),s=[];i.forEach((e,t)=>{const o=e;s[t]=o.style.display,o.style.display="none"});const a=document.elementFromPoint(t.clientX,t.clientY);if(i.forEach((e,t)=>{e.style.display=s[t]}),console.log("🎯 Click target:",{element:a,tagName:a?.tagName,id:a?.id,className:a?.className,xpath:a?z(a):null}),!a||a.closest("[data-uicm-element]"))return void console.log("❌ Invalid target or SDK element, ignoring");e.preventDefault(),e.stopPropagation();const{position:r,relativePosition:l}=g(a,{clientX:t.clientX,clientY:t.clientY});this.showCommentForm(a,r,l)},this.handleElementMouseEnter=e=>{if("comment"!==this.mode)return;const t=e.target;if(t.hasAttribute("data-uicm-element"))return;const o=document.getElementById("uicm-highlight-layer");if(!o)return;const n=t.getBoundingClientRect(),i=document.createElement("div");i.className="uicm-highlight",i.style.position="absolute",i.style.top=`${n.top}px`,i.style.left=`${n.left}px`,i.style.width=`${n.width}px`,i.style.height=`${n.height}px`,i.style.pointerEvents="none",o.appendChild(i),t.dataset.uicmHighlight=i.id=b()},this.handleElementMouseLeave=e=>{if("comment"!==this.mode)return;const t=e.target;if(t.hasAttribute("data-uicm-element"))return;const o=t.dataset.uicmHighlight;if(o){const e=document.getElementById(o);e&&e.remove(),delete t.dataset.uicmHighlight}},this.handleCommentSubmit=async(e,t,o,n)=>{if(!t||!e.trim())return;const i=x(t);if(!i)return;const s=n?{...this.config.currentUser,name:n}:this.config.currentUser,a={id:b(),content:e.trim(),xpath:i,url:this.getCurrentUrl(),position:o,relativePosition:{x:0,y:0},createdAt:(new Date).toISOString(),createdBy:s,role:s.role||"other",replies:[],status:exports.CommentStatus.BUG};if(this.comments.push(a),this.createCommentBubble(a),this.closeActiveComponents(),this.config.onSaveComment)try{const e=await this.config.onSaveComment(a);Object.assign(a,e)}catch(e){console.error("Failed to save comment:",e)}},this.config=e,this.root=t,this.visibilityObserver=new T({threshold:.1,rootMargin:"50px"}),this.eventBatcher=new L,this.positionCache=new N(50),this.isMobile=function(){const e=navigator.userAgent.toLowerCase(),t=["android","iphone","ipad","mobile","tablet"].some(t=>e.includes(t)),o=window.innerWidth<=768;return t||o}(),this.isMobile&&function(){if(document.getElementById("uicm-mobile-styles"))return;const e=document.createElement("style");e.id="uicm-mobile-styles",e.textContent="\n    @media (max-width: 768px) {\n      .uicm-comment-form {\n        width: calc(100vw - 32px) !important;\n        max-width: none !important;\n        min-width: 280px !important;\n      }\n      \n      .uicm-comment-bubble {\n        min-width: 40px !important;\n        min-height: 40px !important;\n        font-size: 14px !important;\n      }\n      \n      .uicm-comment-popup {\n        width: calc(100vw - 32px) !important;\n        max-width: none !important;\n        max-height: calc(100vh - 64px) !important;\n        overflow-y: auto !important;\n      }\n      \n      .uicm-textarea {\n        font-size: 16px !important; /* Prevents zoom on iOS */\n        min-height: 80px !important;\n      }\n      \n      .uicm-btn {\n        min-height: 44px !important; /* iOS touch target size */\n        padding: 12px 20px !important;\n        font-size: 16px !important;\n      }\n      \n      .uicm-form-actions {\n        gap: 12px !important;\n      }\n      \n      .uicm-form-help {\n        font-size: 14px !important;\n        padding: 8px !important;\n      }\n    }\n    \n    @media (max-width: 480px) {\n      .uicm-comment-form {\n        width: calc(100vw - 16px) !important;\n      }\n      \n      .uicm-comment-popup {\n        width: calc(100vw - 16px) !important;\n        max-height: calc(100vh - 32px) !important;\n      }\n      \n      .uicm-form-actions {\n        flex-direction: column !important;\n      }\n      \n      .uicm-btn {\n        width: 100% !important;\n      }\n    }\n    \n    /* Touch-friendly improvements */\n    .uicm-comment-bubble {\n      -webkit-tap-highlight-color: transparent !important;\n      touch-action: manipulation !important;\n    }\n    \n    .uicm-btn {\n      -webkit-tap-highlight-color: transparent !important;\n      touch-action: manipulation !important;\n    }\n    \n    .uicm-textarea {\n      -webkit-tap-highlight-color: transparent !important;\n      touch-action: manipulation !important;\n    }\n    \n    /* Prevent zooming on inputs */\n    .uicm-textarea,\n    .uicm-input {\n      font-size: 16px !important;\n    }\n  ",document.head.appendChild(e)}(),this.attachEventListeners()}attachEventListeners(){this.escKeyHandler=e=>{"Escape"===e.key&&(console.log("🔑 ESC pressed"),this.activeModal||this.activeForm?(this.closeActiveComponents(),e.preventDefault(),e.stopPropagation()):"comment"===this.mode&&(this.setMode("normal"),e.preventDefault(),e.stopPropagation()))},document.addEventListener("keydown",this.escKeyHandler);const e=k(()=>{this.commentBubbles.size>0&&"comment"===this.mode&&this.updateBubblePositions()},16),t=f(()=>{this.commentBubbles.size>0&&"comment"===this.mode&&(this.positionCache.clear(),this.updateBubblePositions())},100);if(window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",t),window.addEventListener("orientationchange",()=>{this.commentBubbles.size>0&&"comment"===this.mode&&(this.positionCache.clear(),setTimeout(()=>{this.updateBubblePositions()},100))}),"undefined"!=typeof MutationObserver){new MutationObserver(e=>{if(0===this.commentBubbles.size||"comment"!==this.mode)return;let t=!1;for(const o of e){const e=o.target;if(!(e.closest("[data-uicm-element]")||e.classList?.contains("uicm-highlight")||e.id?.startsWith("uicm-"))&&("childList"===o.type||"attributes"===o.type&&-1!==["style","class"].indexOf(o.attributeName))){t=!0;break}}t&&(clearTimeout(this.mutationTimeout),this.mutationTimeout=setTimeout(()=>{this.updateBubblePositions()},100))}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]})}document.addEventListener("click",this.handleElementClick),document.addEventListener("mouseenter",this.handleElementMouseEnter,!0),document.addEventListener("mouseleave",this.handleElementMouseLeave,!0),this.isMobile&&("ontouchstart"in window||navigator.maxTouchPoints>0)&&(this.touchGestureRecognizer=new S(document.body,{onTap:e=>{if("comment"===this.mode){const t=new MouseEvent("click",{clientX:e.x,clientY:e.y,bubbles:!0,cancelable:!0});Object.defineProperty(t,"target",{value:e.target,writable:!1}),this.handleElementClick(t)}},onLongPress:e=>{"normal"===this.mode&&this.setMode("comment")}})),setTimeout(()=>{this.commentBubbles.size>0&&this.forceUpdateBubblePositions()},100)}closeActiveComponents(){if(this.activeForm){const e=this.activeForm.getElement();e&&e.parentNode&&e.parentNode.removeChild(e),this.activeForm=null}this.activeModal&&(this.activeModal.destroy(),this.activeModal=null),this.removeOverlay()}createOverlay(){this.removeOverlay();const e=document.createElement("div");e.className="uicm-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.style.zIndex="999997",e.style.cursor="pointer",e.addEventListener("click",t=>{t.target===e&&(t.stopPropagation(),console.log("🔒 Overlay direct click, closing active components"),this.closeActiveComponents())});const t=e=>{const o=e.target,n=o&&this.activeModal&&this.activeModal.getElement&&this.activeModal.getElement().contains(o),i=o&&this.activeForm&&this.activeForm.getElement().contains(o);n||i||(console.log("🔒 Global click outside modal/form, closing active components"),this.closeActiveComponents(),document.removeEventListener("click",t))};setTimeout(()=>{document.addEventListener("click",t)},100);const o=document.getElementById("uicm-interaction-layer");return o&&o.appendChild(e),this.activeOverlay=e,console.log("✅ Overlay created with global click handler"),e}removeOverlay(){this.activeOverlay&&(this.activeOverlay.parentNode&&this.activeOverlay.parentNode.removeChild(this.activeOverlay),this.activeOverlay=null,console.log("✅ Overlay removed"))}showModal(e){console.log("🔄 CommentManager: Showing modal"),this.closeActiveComponents(),this.createOverlay(),this.activeModal=e,console.log("✅ Modal shown with overlay")}showCommentForm(e,t,o){this.closeActiveComponents(),this.createOverlay(),requestAnimationFrame(()=>{const o=new E({onSubmit:async(o,n,i)=>{const s=e.getBoundingClientRect(),a=Math.max(0,Math.min(1,(t.x-s.left)/s.width)),r=Math.max(0,Math.min(1,(t.y-s.top)/s.height)),l=n?{...this.config.currentUser,name:n}:this.config.currentUser,c={content:o,xpath:x(e)||"",url:this.getCurrentUrl(),position:{x:s.left+s.width*a,y:s.top+s.height*r},relativePosition:{x:a,y:r},createdBy:l,role:l.role||"other",status:exports.CommentStatus.BUG,replies:[],attachments:i||[]},m=await this.config.onSaveComment(c);this.comments.push(m),this.createCommentBubble(m),this.closeActiveComponents()},onCancel:()=>this.closeActiveComponents(),position:t,element:e,currentUser:this.config.currentUser}),n=document.getElementById("uicm-interaction-layer");n&&(n.appendChild(o.getElement()),o.reposition()),this.activeForm=o,console.log("✅ Comment form shown with overlay")})}hideCommentForm(){this.activeForm&&(this.activeForm.destroy(),this.activeForm=null)}addBubbleToLayer(e){const t=document.getElementById("uicm-interaction-layer");t?(t.appendChild(e.getElement()),console.log("✅ Bubble added to interaction layer")):console.error("❌ Interaction layer not found")}async createComment(e,t,o,n){const i=x(e);if(!i)return;const s={content:t.trim(),xpath:i,url:this.getCurrentUrl(),position:o,relativePosition:n,createdBy:this.config.currentUser,role:this.config.currentUser.role||"other",status:exports.CommentStatus.BUG,replies:[]};try{const e=await this.config.onSaveComment(s);this.comments.push(e),this.createCommentBubble(e)}catch(e){console.error("Failed to create comment:",e)}}createCommentBubble(e){const t=M(e.xpath);if(!t||!U(t))return void console.warn("Element not found for comment:",e.xpath);const o=t.getBoundingClientRect(),n=o.left+o.width*e.relativePosition.x,i=o.top+o.height*e.relativePosition.y,s=new C({comment:e,position:{x:n,y:i},currentUser:this.config.currentUser,onReply:(e,t,o,n)=>this.addReply(e,t,o,n),onResolve:e=>this.resolveComment(e),onDelete:e=>this.deleteComment(e),onShowModal:e=>this.showModal(e),onStatusChange:(e,t)=>this.changeCommentStatus(e,t)});this.addBubbleToLayer(s),this.commentBubbles.set(e.id,s),this.visibilityObserver.observe(s.getElement(),e=>{}),this.positionCache.set(e.id,{x:n,y:i})}async addReply(e,t,o,n){const i=this.comments.find(t=>t.id===e);if(!i)return;const s=o||this.config.currentUser,a={id:b(),content:t,xpath:i.xpath,url:i.url,position:i.position,relativePosition:i.relativePosition,createdAt:(new Date).toISOString(),createdBy:s,role:s.role||"other",replies:[],status:exports.CommentStatus.BUG,attachments:n||[]};i.replies.push(a),this.config.onUpdateComment&&await this.config.onUpdateComment(i);const r=this.commentBubbles.get(e);r&&r.updateComment(i)}async resolveComment(e){const t=this.comments.find(t=>t.id===e);if(!t)return;t.status=exports.CommentStatus.DONE,t.resolvedAt=(new Date).toISOString(),this.config.onUpdateComment&&await this.config.onUpdateComment(t);const o=this.commentBubbles.get(e);o&&o.updateComment(t)}async changeCommentStatus(e,t){const o=this.comments.find(t=>t.id===e);if(!o)return;const n=o.status;o.status=t,t===exports.CommentStatus.DONE&&n!==exports.CommentStatus.DONE?o.resolvedAt=(new Date).toISOString():t===exports.CommentStatus.ARCHIVED&&n!==exports.CommentStatus.ARCHIVED&&(o.archivedAt=(new Date).toISOString()),console.log("📝 Comment status changed:",{commentId:e,previousStatus:n,newStatus:t,timestamp:(new Date).toISOString()}),this.config.onUpdateComment&&await this.config.onUpdateComment(o);const i=this.commentBubbles.get(e);i&&i.updateComment(o)}async deleteComment(e){const t=this.comments.find(t=>t.id===e);if(!t)return;if(t.status=exports.CommentStatus.ARCHIVED,this.config.onDeleteComment)try{await this.config.onDeleteComment(e)}catch(e){return void console.error("Failed to delete comment:",e)}this.comments=this.comments.filter(t=>t.id!==e);const o=this.commentBubbles.get(e);o&&(o.destroy(),this.commentBubbles.delete(e))}updateBubblePositions(){0!==this.commentBubbles.size&&"normal"!==this.mode&&(console.log("🔄 Updating bubble positions, total bubbles:",this.commentBubbles.size,"mode:",this.mode),this.commentBubbles.forEach((e,t)=>{const o=this.comments.find(e=>e.id===t);if(!o)return void console.warn("❌ Comment not found for bubble:",t);if(o.status===exports.CommentStatus.ARCHIVED)return e.getElement().style.display="none",void console.log("📦 Hiding archived bubble:",t);const n=M(o.xpath);if(!n||!U(n))return console.log("❌ Element not found, hiding bubble:",o.xpath),void(e.getElement().style.display="none");e.getElement().style.display="flex";const i=n.getBoundingClientRect(),s=i.left+i.width*o.relativePosition.x,a=i.top+i.height*o.relativePosition.y;console.log("📍 Updating bubble position:",{commentId:t,xpath:o.xpath,elementRect:{left:i.left,top:i.top,width:i.width,height:i.height},relativePosition:o.relativePosition,newPosition:{x:s,y:a},status:o.status}),e.updatePosition({x:s,y:a}),this.positionCache.set(t,{x:s,y:a})}))}forceUpdateBubblePositions(){0!==this.commentBubbles.size&&(console.log("🔄 Force updating bubble positions:",this.commentBubbles.size),this.commentBubbles.forEach((e,t)=>{const o=this.comments.find(e=>e.id===t);if(!o)return void console.warn("❌ Comment not found for bubble:",t);const n=M(o.xpath);if(!n||!U(n))return void(e.getElement().style.display="none");e.getElement().style.display="flex";const i=n.getBoundingClientRect(),s=i.left+i.width*o.relativePosition.x,a=i.top+i.height*o.relativePosition.y;e.updatePosition({x:s,y:a}),this.positionCache.set(t,{x:s,y:a})}))}getCurrentUrl(){return window.location.href}async loadComments(){try{const e=await this.config.onLoadComments(),t=this.getCurrentUrl();this.comments=e.filter(e=>e.url===t),this.comments.forEach(e=>{this.createCommentBubble(e)}),this.comments.length>0&&setTimeout(()=>{this.forceUpdateBubblePositions()},100)}catch(e){console.error("Failed to load comments:",e)}}updateLayerVisibility(){const e=document.getElementById("uicm-interaction-layer"),t=document.getElementById("uicm-highlight-layer");"comment"===this.mode?(e&&(e.style.display="block",this.commentBubbles.forEach((e,t)=>{const o=this.comments.find(e=>e.id===t);o&&o.status===exports.CommentStatus.ARCHIVED?e.getElement().style.display="none":e.getElement().style.display="flex"})),t&&(t.style.display="block"),setTimeout(()=>{this.forceUpdateBubblePositions()},50)):(e&&(e.style.display="none"),t&&(t.style.display="none"))}setMode(e){this.mode=e,this.updateLayerVisibility(),"comment"===e&&this.commentBubbles.size>0&&(console.log("🔄 Switching to comment mode, updating bubble positions"),this.forceUpdateBubblePositions(),setTimeout(()=>{this.forceUpdateBubblePositions()},100))}getMode(){return this.mode}getComments(){return[...this.comments]}getCommentsForElement(e){const t=z(e);return this.comments.filter(e=>e.xpath===t)}getCommentBubble(e){return this.commentBubbles.get(e)||null}updateCurrentUser(e){this.config.currentUser=e,console.log("🔄 CommentManager: Current user updated:",e),this.refreshAllCommentBubbles()}refreshAllCommentBubbles(){this.commentBubbles.forEach((e,t)=>{const o=this.comments.find(e=>e.id===t);o&&(e.updateComment(o),e.updateUser(this.config.currentUser))})}highlightElement(e){this.root.querySelectorAll(".uicm-element-highlight").forEach(e=>e.remove());const t=document.createElement("div");t.className="uicm-element-highlight",t.setAttribute("data-uicm-element","true");const o=e.getBoundingClientRect();t.style.left=`${o.left}px`,t.style.top=`${o.top}px`,t.style.width=`${o.width}px`,t.style.height=`${o.height}px`,this.root.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},3e3)}testBubbleClicks(){console.log("🧪 TESTING ALL BUBBLE CLICKS"),console.log("Mode:",this.mode),console.log("Bubble count:",this.commentBubbles.size);const e=document.getElementById("uicm-interaction-layer");console.log("Interaction layer:",{found:!!e,display:e?.style.display,computedDisplay:e?getComputedStyle(e).display:null,children:e?.children.length}),this.commentBubbles.forEach((e,t)=>{console.log(`🔍 Testing bubble ${t}:`),e.testClickability()})}destroy(){this.closeActiveComponents(),window.removeEventListener("scroll",this.rafUpdatePositions),window.removeEventListener("resize",this.throttledUpdatePositions),document.removeEventListener("click",this.handleElementClick),document.removeEventListener("mouseenter",this.handleElementMouseEnter,!0),document.removeEventListener("mouseleave",this.handleElementMouseLeave,!0),this.escKeyHandler&&document.removeEventListener("keydown",this.escKeyHandler),this.visibilityObserver.disconnect(),this.positionCache.clear(),this.touchGestureRecognizer&&this.touchGestureRecognizer.destroy(),this.isMobile&&function(){const e=document.getElementById("uicm-mobile-styles");e&&e.remove()}(),this.commentBubbles.forEach(e=>e.destroy()),this.commentBubbles.clear(),console.log("CommentManager destroyed")}}class B{constructor(e){this.sidebar=null,this.isInitialized=!1,this.comments=[],this.config={theme:"light",...e};const t=m.loadUserProfile();this.currentUser=t||{id:"default-user",name:"Anonymous User",role:"other"},t||m.saveUserProfile(this.currentUser),this.validateConfig()}validateConfig(){if(!this.config.projectId)throw new Error("CommentSDK: projectId is required");if(!this.config.onFetchJsonFile)throw new Error("CommentSDK: onFetchJsonFile function is required");if(!this.config.onUpdate)throw new Error("CommentSDK: onUpdate callback is required")}async init(){if(this.isInitialized)console.warn("EasyCommentSDK: Already initialized");else try{this.setupDOM(),await this.loadCommentsFromUserFunction();const e={projectId:this.config.projectId,currentUser:this.currentUser,theme:this.config.theme,onLoadComments:async()=>this.comments,onSaveComment:async e=>{const t={...e,id:this.generateId(),createdAt:(new Date).toISOString()};return this.comments.push(t),await this.saveCommentsToJsonFile(),t},onUpdateComment:async e=>{const t=this.comments.findIndex(t=>t.id===e.id);return-1!==t&&(this.comments[t]=e,await this.saveCommentsToJsonFile()),e},onDeleteComment:async e=>{this.comments=this.comments.filter(t=>t.id!==e),await this.saveCommentsToJsonFile()}};this.commentManager=new P(e,this.root),this.initializeUI(),await this.commentManager.loadComments(),this.isInitialized=!0,console.log("CommentSDK: Initialized successfully")}catch(e){throw console.error("CommentSDK: Failed to initialize",e),e}}setupDOM(){this.root=function(){let e=document.getElementById("uicm-root");if(!e){e=document.createElement("div"),e.id="uicm-root",e.setAttribute("data-uicm-element","true"),e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.pointerEvents="none",e.style.zIndex="999999";const t=document.createElement("div");t.id="uicm-highlight-layer",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.pointerEvents="none",t.style.display="none",e.appendChild(t);const o=document.createElement("div");o.id="uicm-interaction-layer",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.pointerEvents="auto",o.style.display="none",e.appendChild(o),document.body.appendChild(e)}return e}(),this.root.className=`uicm-theme-${this.config.theme}`}async loadCommentsFromUserFunction(){try{const e=await this.config.onFetchJsonFile();this.comments=e.comments||[],console.log(`📂 Loaded ${this.comments.length} comments from user function`)}catch(e){console.log("📂 Could not load comments from user function, starting fresh"),this.comments=[]}}async saveCommentsToJsonFile(){try{this.config.projectId,this.comments,(new Date).toISOString();await this.config.onUpdate(this.comments),console.log(`💾 Saved ${this.comments.length} comments to JSON file`)}catch(e){console.error("Failed to save comments:",e)}}initializeUI(){this.debugIcon=new a({isActive:!1,onClick:()=>this.toggleMode(),theme:this.config.theme}),this.settingsButton=new d({currentUser:this.currentUser,onUserUpdate:async e=>{this.currentUser=e,this.commentManager.updateCurrentUser(e),m.saveUserProfile(e),this.sidebarButton.updateUser(e),this.sidebar&&this.sidebar.updateComments(this.comments)},isVisible:!1}),this.sidebarButton=new p({currentUser:this.currentUser,onClick:()=>this.openSidebar(),isVisible:!1}),document.body.appendChild(this.debugIcon.getElement()),document.body.appendChild(this.settingsButton.getElement()),document.body.appendChild(this.sidebarButton.getElement())}toggleMode(){const e="normal"===this.commentManager.getMode()?"comment":"normal";this.setMode(e)}setMode(e){if(!this.isInitialized)throw new Error("CommentSDK: Not initialized. Call init() first.");this.commentManager.setMode(e),this.debugIcon.updateState("comment"===e),this.settingsButton.setVisible("comment"===e),this.sidebarButton.setVisible("comment"===e),document.body.style.cursor="comment"===e?"crosshair":""}openSidebar(){if(this.sidebar)return this.sidebar.destroy(),void(this.sidebar=null);this.sidebar=new s({comments:this.comments,currentUser:this.currentUser,onNavigateToComment:e=>this.navigateToComment(e),onClose:()=>{this.sidebar&&(this.sidebar.destroy(),this.sidebar=null)},onStatusChange:async(e,t)=>{const o=this.comments.find(t=>t.id===e);o&&(o.status=t,await this.saveCommentsToJsonFile())}}),document.body.appendChild(this.sidebar.getElement()),this.sidebar.show()}navigateToComment(e){const t=this.findElementByXPath(e.xpath);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.outline="2px solid #3b82f6",t.style.outlineOffset="2px",setTimeout(()=>{t.style.outline="",t.style.outlineOffset=""},3e3))}findElementByXPath(e){try{return document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch{return null}}generateId(){return`comment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}destroy(){this.sidebar&&this.sidebar.destroy(),this.commentManager&&this.commentManager.destroy(),this.isInitialized=!1}getComments(){return this.comments}getCurrentUser(){return this.currentUser}}function F(e){return new B(e)}i("#uicm-root{z-index:999998}#uicm-highlight-layer,#uicm-root{height:100%;left:0;pointer-events:none;position:fixed;top:0;width:100%}#uicm-highlight-layer{z-index:1}#uicm-interaction-layer{height:100%;left:0;pointer-events:none;position:fixed;top:0;width:100%;z-index:2}.uicm-overlay{background-color:rgba(0,0,0,.1);cursor:pointer;height:100vh;left:0;pointer-events:auto;position:fixed;top:0;width:100vw;z-index:999997}.uicm-comment-form,.uicm-comment-modal{pointer-events:auto!important;position:relative;z-index:999999!important}.uicm-comment-bubble{pointer-events:auto!important;position:relative;z-index:100!important}");i(".uicm-image-modal{align-items:center;background:rgba(0,0,0,.9);display:flex;height:100vh;justify-content:center;left:0;opacity:0;pointer-events:auto;position:fixed;top:0;transition:opacity .3s ease,visibility .3s ease;visibility:hidden;width:100vw;z-index:999999}.uicm-image-modal.show{opacity:1;visibility:visible}.uicm-image-container{align-items:center;display:flex;justify-content:center;max-height:80vh;max-width:80vw;position:relative}.uicm-image-container img{border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,.5);cursor:zoom-in;max-height:100%;max-width:100%;object-fit:contain;transition:transform .3s ease;user-select:none}.uicm-image-close{align-items:center;background:none;border:none;border-radius:50%;color:#fff;cursor:pointer;display:flex;font-size:32px;height:40px;justify-content:center;position:absolute;right:0;top:-40px;transition:background-color .2s ease;width:40px}.uicm-image-close:hover{background-color:hsla(0,0%,100%,.1)}.uicm-image-download{align-items:center;background:none;border:none;border-radius:50%;color:#fff;cursor:pointer;display:flex;font-size:20px;height:40px;justify-content:center;position:absolute;right:50px;top:-40px;transition:background-color .2s ease;width:40px}.uicm-image-download:hover,.uicm-image-reset:hover,.uicm-image-zoom-in:hover,.uicm-image-zoom-out:hover{background-color:hsla(0,0%,100%,.1)}@media (max-width:768px){.uicm-image-container{max-height:90vh;max-width:95vw}.uicm-image-close{font-size:28px;height:36px;right:10px;top:-50px;width:36px}.uicm-image-download{font-size:18px;height:36px;right:50px;top:-50px;width:36px}.uicm-image-reset,.uicm-image-zoom-in,.uicm-image-zoom-out{font-size:14px;height:36px;top:-50px;width:36px}.uicm-image-zoom-in{right:90px}.uicm-image-zoom-out{right:130px}.uicm-image-reset{right:170px}}");i('.uicm-comment-modal{animation:uicm-modal-slide-in .4s cubic-bezier(.34,1.56,.64,1);background:linear-gradient(145deg,#fff,#f8fafc);border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.15);font-family:Inter,sans-serif;max-height:740px;max-width:500px;min-width:400px;overflow:hidden;position:relative;transition:all .3s cubic-bezier(.4,0,.2,1)}.uicm-comment-modal:hover{box-shadow:0 40px 80px rgba(0,0,0,.15),0 20px 40px rgba(30,0,0,.1),0 0 0 1px hsla(0,0%,100%,.6),inset 0 1px 0 hsla(0,0%,100%,.9);transform:translateY(-2px)}.uicm-modal-header-bar{background:linear-gradient(135deg,var(--uicm-accent,#3b82f6) 0,#8b5cf6 25%,#06b6d4 50%,#10b981 75%,#f59e0b 100%);border-radius:20px 20px 0 0;height:4px;left:0;position:absolute;right:0;top:0}.uicm-modal-header{background:linear-gradient(135deg,#fff,#f8fafc);border-bottom:1px solid #e5e7eb;border-radius:16px 16px 0 0;box-shadow:0 2px 8px rgba(0,0,0,.05);padding:0;position:relative}.uicm-modal-header:before{background:linear-gradient(90deg,#3b82f6,#06b6d4,#10b981);border-radius:12px 12px 0 0;content:"";height:3px;left:0;position:absolute;right:0;top:0}.uicm-modal-header-content{display:flex;flex-direction:column;padding:0}.uicm-modal-top-section{align-items:flex-start;display:flex;gap:20px;justify-content:space-between;padding:24px 28px 16px}.uicm-modal-title-section{display:flex;flex:1;flex-direction:column;gap:4px;min-width:0}.uicm-modal-title{color:#1f2937;font-size:24px;font-weight:700;letter-spacing:-.025em;line-height:1.2;margin:0}.uicm-modal-description{color:#6b7280;font-size:14px;font-weight:500;line-height:1.4;margin:0}.uicm-close-button{align-items:center;background:linear-gradient(145deg,rgba(239,68,68,.1),rgba(220,38,38,.08));border:1px solid rgba(239,68,68,.2);border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08);color:#dc2626;cursor:pointer;display:flex;flex-shrink:0;font-size:18px;font-weight:700;height:36px;justify-content:center;padding:8px;transition:all .3s cubic-bezier(.4,0,.2,1);width:36px}.uicm-close-button:hover{background:linear-gradient(145deg,rgba(239,68,68,.15),rgba(220,38,38,.12));border-color:rgba(239,68,68,.3);box-shadow:0 4px 12px rgba(239,68,68,.2);transform:translateY(-1px)}.uicm-modal-bottom-section{align-items:center;display:flex;gap:12px;justify-content:center;padding:0 28px 24px}.uicm-status-select{backdrop-filter:blur(8px);background:linear-gradient(145deg,hsla(0,0%,100%,.9),rgba(248,250,252,.8));border:1px solid hsla(0,0%,100%,.4);border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);color:#374151;cursor:pointer;font-size:14px;font-weight:600;padding:10px 16px;transition:all .3s cubic-bezier(.4,0,.2,1);width:85%}.uicm-status-select:hover{background:linear-gradient(145deg,#fff,rgba(248,250,252,.9));border-color:rgba(59,130,246,.3);box-shadow:0 4px 12px rgba(59,130,246,.15);transform:translateY(-1px)}.uicm-status-select:focus{border-color:rgba(59,130,246,.5);box-shadow:0 0 0 3px rgba(59,130,246,.1);outline:none}.uicm-status-select[data-status=bug]{color:#dc3545;font-weight:700}.uicm-status-select[data-status=feature_request]{color:#ffc107;font-weight:700}.uicm-status-select[data-status=dev_completed]{color:#3b82f6;font-weight:700}.uicm-status-select[data-status=done]{color:#28a745;font-weight:700}.uicm-status-select[data-status=archived]{color:#6c757d;font-weight:700}.uicm-status-select option[value=bug]{color:#dc3545}.uicm-status-select option[value=feature_request]{color:#ffc107}.uicm-status-select option[value=dev_completed]{color:#3b82f6}.uicm-status-select option[value=done]{color:#28a745}.uicm-status-select option[value=archived]{color:#6c757d}.uicm-delete-button{align-items:center;background:linear-gradient(145deg,rgba(239,68,68,.1),rgba(220,38,38,.08));border:1px solid rgba(239,68,68,.2);border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08);color:#dc2626;cursor:pointer;display:flex;flex-shrink:0;font-size:16px;font-weight:600;height:36px;justify-content:center;padding:8px;transition:all .3s cubic-bezier(.4,0,.2,1);width:36px}.uicm-delete-button:hover{background:linear-gradient(145deg,rgba(239,68,68,.15),rgba(220,38,38,.12));border-color:rgba(239,68,68,.3);box-shadow:0 4px 12px rgba(239,68,68,.2);transform:translateY(-1px)}.uicm-delete-button:disabled{cursor:not-allowed;opacity:.5;transform:none}.uicm-comments-list{max-height:400px;overflow-y:auto;padding:24px 28px;scrollbar-color:#cbd5e1 #f1f5f9;scrollbar-width:thin}.uicm-comment-item{background:hsla(0,0%,100%,.8);border:1px solid rgba(229,231,235,.5);border-radius:12px;margin-bottom:20px;padding:16px}.uicm-comment-item:last-child{margin-bottom:0}.uicm-comment-avatar{align-items:center;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:50%;color:#fff;display:flex;font-size:14px;font-weight:600;height:32px;justify-content:center;margin-right:12px;width:32px}.uicm-comment-content{flex:1}.uicm-comment-header{align-items:center;display:flex;gap:8px;margin-bottom:8px}.uicm-author-name{color:#1f2937;font-size:14px;font-weight:600}.uicm-role-badge{background:linear-gradient(135deg,rgba(59,130,246,.1),rgba(139,92,246,.1));border:1px solid rgba(59,130,246,.2);border-radius:8px;color:#3b82f6;font-size:11px;font-weight:600;letter-spacing:.5px;padding:2px 8px;text-transform:uppercase}.uicm-comment-time{color:#6b7280;font-size:12px;margin-left:auto}.uicm-comment-text{word-wrap:break-word;color:#374151;font-size:14px;line-height:1.5;margin:0}.uicm-reply-form{border-top:1px solid #e5e7eb;margin-top:16px;padding-top:16px}.uicm-reply-header{align-items:center;display:flex;gap:8px;margin-bottom:12px}.uicm-reply-avatar{align-items:center;background:linear-gradient(135deg,#10b981,#06b6d4);border-radius:50%;color:#fff;display:flex;font-size:12px;font-weight:600;height:28px;justify-content:center;width:28px}.uicm-reply-user-name-input{background:hsla(0,0%,100%,.8);border:1px solid #d1d5db;border-radius:8px;color:#374151;font-size:13px;padding:6px 12px;transition:all .2s ease}.uicm-reply-user-name-input:hover{border-color:#9ca3af}.uicm-reply-user-name-input:focus{border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,.1);outline:none}.uicm-reply-input-container{position:relative}.uicm-reply-input{background:hsla(0,0%,100%,.9);border:1px solid #d1d5db;border-radius:10px;color:#374151;font-size:14px;min-height:60px;padding:12px 16px;resize:vertical;transition:all .2s ease;width:100%}.uicm-reply-input:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1);outline:none}.uicm-reply-input::placeholder{color:#9ca3af}.uicm-reply-char-counter{background:hsla(0,0%,100%,.9);border-radius:4px;bottom:8px;color:#6b7280;font-size:11px;padding:2px 6px;position:absolute;right:12px}.uicm-reply-char-counter.uicm-warning{color:#f59e0b}.uicm-reply-char-counter.uicm-error{color:#dc2626}.uicm-reply-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}.uicm-reply-send{background:linear-gradient(135deg,#3b82f6,#8b5cf6);border:none;border-radius:8px;color:#fff;cursor:pointer;font-size:13px;font-weight:600;padding:8px 16px;transition:all .2s ease}.uicm-reply-send:hover:not(:disabled){box-shadow:0 4px 12px rgba(59,130,246,.3);transform:translateY(-1px)}.uicm-reply-send:disabled{cursor:not-allowed;opacity:.5;transform:none}.uicm-status-badge{align-items:center;border-radius:6px;display:inline-flex;font-size:11px;font-weight:600;letter-spacing:.5px;padding:4px 8px;text-transform:uppercase}.uicm-status-badge.status-bug{background:rgba(220,53,69,.1);color:#dc3545}.uicm-status-badge.status-feature_request{background:rgba(255,193,7,.1);color:#ffc107}.uicm-status-badge.status-dev_completed{background:rgba(59,130,246,.1);color:#3b82f6}.uicm-status-badge.status-done{background:rgba(40,167,69,.1);color:#28a745}.uicm-status-badge.status-archived{background:hsla(208,7%,46%,.1);color:#6c757d}.uicm-file-upload-section{margin-top:16px}.uicm-file-upload-button{background:linear-gradient(135deg,rgba(59,130,246,.1),rgba(139,92,246,.1));border:1px solid rgba(59,130,246,.2);border-radius:8px;color:#3b82f6;cursor:pointer;font-size:13px;font-weight:600;padding:8px 16px;transition:all .2s ease}.uicm-file-upload-button:hover{background:linear-gradient(135deg,rgba(59,130,246,.15),rgba(139,92,246,.15));transform:translateY(-1px)}.uicm-file-preview-container{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}.uicm-file-preview-item{background:hsla(0,0%,100%,.9);border:1px solid #e5e7eb;border-radius:8px;max-width:120px;padding:8px;position:relative}.uicm-file-preview-remove{align-items:center;background:#dc2626;border:none;border-radius:50%;color:#fff;cursor:pointer;display:flex;font-size:12px;height:20px;justify-content:center;position:absolute;right:-4px;top:-4px;width:20px}.uicm-file-preview-remove:hover{background:#b91c1c}.uicm-file-preview-info{margin-top:4px;text-align:center}.uicm-file-preview-size{color:#6b7280;font-size:10px;margin-top:2px}.uicm-file-preview-image{border-radius:4px;height:80px;margin-bottom:4px;object-fit:cover;width:100%}.uicm-file-preview-icon{align-items:center;background:#f3f4f6;border-radius:4px;color:#6b7280;display:flex;height:40px;justify-content:center;margin:0 auto 4px;width:40px}.uicm-comment-attachments{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}.uicm-attachment-item{background:hsla(0,0%,100%,.9);border:1px solid #e5e7eb;border-radius:8px;cursor:pointer;max-width:120px;padding:8px;transition:all .2s ease}.uicm-attachment-item:hover{box-shadow:0 4px 12px rgba(0,0,0,.1);transform:translateY(-1px)}.uicm-attachment-image{border-radius:4px;height:80px;margin-bottom:4px;object-fit:cover;width:100%}.uicm-attachment-image:hover{opacity:.8}.uicm-attachment-icon{align-items:center;background:#f3f4f6;border-radius:4px;color:#6b7280;display:flex;height:40px;justify-content:center;margin:0 auto 4px;width:40px}.uicm-attachment-info{text-align:center}.uicm-attachment-name{color:#374151;font-size:11px;font-weight:500;line-height:1.3;word-break:break-word}.uicm-attachment-size{color:#6b7280;font-size:10px;margin-top:2px}@keyframes uicm-modal-slide-in{0%{opacity:0;transform:scale(.9) translateY(-20px)}to{opacity:1;transform:scale(1) translateY(0)}}.uicm-comments-list::-webkit-scrollbar{width:6px}.uicm-comments-list::-webkit-scrollbar-track{background:#f1f5f9;border-radius:3px}.uicm-comments-list::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.uicm-comments-list::-webkit-scrollbar-thumb:hover{background:#94a3b8}@media (max-width:480px){.uicm-comment-modal{margin:20px;max-width:95vw;min-width:320px}.uicm-modal-top-section{padding:20px 20px 12px}.uicm-modal-title{font-size:20px}.uicm-modal-description{font-size:13px}.uicm-modal-bottom-section{padding:0 20px 20px}.uicm-status-select{width:80%}.uicm-close-button,.uicm-delete-button{height:32px;width:32px}.uicm-close-button{font-size:16px}.uicm-comments-list,.uicm-reply-form{padding:16px 20px}.uicm-reply-actions{flex-direction:column}.uicm-reply-cancel,.uicm-reply-send{width:100%}.uicm-comment-item{padding:12px}.uicm-comment-avatar{font-size:12px;height:28px;width:28px}.uicm-reply-avatar{font-size:11px;height:24px;width:24px}}');i(".uicm-comment-bubble{align-items:center;background-color:#007bff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,.2);color:#fff;cursor:pointer;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;font-size:16px;font-weight:700;height:32px;justify-content:center;position:absolute;transition:all .2s ease;width:32px;z-index:9999}.uicm-comment-bubble:hover{box-shadow:0 4px 12px rgba(0,0,0,.3);transform:scale(1.1)}.uicm-comment-bubble:active{transform:scale(.95)}.uicm-comment-count-badge{align-items:center;border:2px solid;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.3);display:flex;font-size:10px;font-weight:700;height:18px;justify-content:center;position:absolute;right:-6px;top:-6px;transition:all .2s ease;width:18px;z-index:101}.uicm-comment-count-badge:hover{transform:scale(1.1)}");i('.uicm-comment-form{animation:uicm-form-slide-in .2s cubic-bezier(.34,1.56,.64,1);background:linear-gradient(145deg,#fff,#f8fafc);border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.15);font-family:Inter,sans-serif;max-width:480px;min-width:380px;overflow:hidden;transition:all .2s cubic-bezier(.4,0,.2,1);will-change:transform,opacity}.uicm-comment-form:hover{box-shadow:0 40px 80px rgba(0,0,0,.15),0 20px 40px rgba(0,0,0,.1),0 0 0 1px hsla(0,0%,100%,.6),inset 0 1px 0 hsla(0,0%,100%,.9);transform:translateY(-2px)}.uicm-comment-form:before{background:linear-gradient(135deg,var(--uicm-accent,#3b82f6) 0,#8b5cf6 25%,#06b6d4 50%,#10b981 75%,#f59e0b 100%);border-radius:var(--uicm-border-radius,20px) var(--uicm-border-radius,20px) 0 0;content:"";height:4px;left:0;position:absolute;right:0;top:0}.uicm-form-header{background:#fff;border-bottom:1px solid #e5e7eb;border-radius:16px 16px 0 0;padding:0}.uicm-form-header-content{align-items:flex-start;display:flex;gap:16px;justify-content:space-between;padding:24px 24px 20px}.uicm-form-title-section{display:flex;flex:1;flex-direction:column;gap:4px}.uicm-form-title{color:#1f2937;font-size:22px;font-weight:700;letter-spacing:-.02em;line-height:1.2;margin:0}.uicm-form-subtitle{color:#6b7280;font-size:14px;font-weight:500;line-height:1.4;margin:0}.uicm-form-action-section{align-items:center;display:flex;flex-shrink:0;gap:8px}.uicm-user-info{align-items:center;display:flex;gap:12px;margin-bottom:16px}.uicm-user-avatar{align-items:center;background:linear-gradient(135deg,#3b82f6,#06b6d4);border-radius:50%;color:#fff;display:flex;font-size:16px;font-weight:600;height:40px;justify-content:center;transition:transform .2s;width:40px}.uicm-user-avatar:hover{transform:scale(1.1)}.uicm-user-details{display:flex;flex-direction:column;gap:4px}.uicm-user-name-input{background:transparent;border:none;border-radius:6px;color:#1f2937;font-size:14px;font-weight:600;line-height:1.2;max-width:180px;outline:none;padding:4px 8px;transition:all .2s ease}.uicm-user-name-input:hover{background:rgba(59,130,246,.05)}.uicm-user-name-input:focus{background:rgba(59,130,246,.1);box-shadow:0 0 0 2px rgba(59,130,246,.2)}.uicm-user-name-input::placeholder{color:var(--uicm-text-secondary,#64748b);opacity:.7}.uicm-user-name{color:var(--uicm-text-primary,#0f172a);font-size:16px;font-weight:700;letter-spacing:-.01em;line-height:1.2}.uicm-close-button{align-items:center;background:linear-gradient(145deg,hsla(0,0%,100%,.8),hsla(43,47%,94%,.6));border:1px solid rgba(224,122,95,.2);border-radius:20px;box-shadow:0 4px 12px rgba(224,122,95,.1);color:#6b5b47;cursor:pointer;display:flex;font-size:20px;font-weight:600;height:40px;justify-content:center;line-height:1;padding:10px;transition:all .3s cubic-bezier(.4,0,.2,1);width:40px}.uicm-form-content{background:#fff;padding:20px 24px}.uicm-comment-textarea{background:#fff;border:1px solid #d1d5db;border-radius:8px;color:#374151;font-family:inherit;font-size:14px;line-height:1.5;max-height:200px;min-height:80px;outline:none;padding:12px 16px;resize:none;transition:all .2s ease;width:100%}.uicm-comment-textarea:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1)}.uicm-comment-textarea::placeholder{color:#9ca3af;font-style:normal;opacity:.7}.uicm-char-counter{color:var(--uicm-text-secondary,#64748b);font-size:13px;font-weight:600;letter-spacing:.02em;margin:12px 0 20px;text-align:right;transition:all .3s ease}.uicm-char-counter.uicm-warning{animation:uicm-glow-warning 2s infinite;color:var(--uicm-warning,#f59e0b)}.uicm-char-counter.uicm-error{animation:uicm-glow-error 1s infinite;color:var(--uicm-danger,#ef4444);font-weight:700}.uicm-form-actions{align-items:center;display:flex;gap:20px;justify-content:space-between}.uicm-secondary-actions{align-items:center;display:flex;gap:12px}.uicm-emoji-button,.uicm-mention-button{align-items:center;backdrop-filter:blur(8px);background:hsla(0,0%,100%,.6);border:1px solid hsla(0,0%,100%,.3);border-radius:12px;color:var(--uicm-text-secondary,#64748b);cursor:pointer;display:flex;font-size:16px;font-weight:500;gap:6px;padding:10px 14px;transition:all .3s cubic-bezier(.4,0,.2,1)}.uicm-emoji-button:hover,.uicm-mention-button:hover{background:hsla(0,0%,100%,.8);border-color:var(--uicm-accent,#3b82f6);box-shadow:0 8px 16px rgba(59,130,246,.2);color:var(--uicm-accent,#3b82f6);transform:translateY(-2px) scale(1.05)}.uicm-primary-actions{align-items:center;display:flex;justify-content:flex-end}.uicm-submit-button{align-items:center;background:#3b82f6;border:none;border-radius:8px;color:#fff;cursor:pointer;display:flex;font-size:14px;font-weight:600;gap:8px;padding:8px 20px;transition:background-color .2s ease}.uicm-submit-button:hover:not(:disabled){background:#2563eb}.uicm-submit-button:disabled{background:#9ca3af;box-shadow:none;cursor:not-allowed;transform:none}.uicm-submit-button kbd{background:hsla(0,0%,100%,.2);border-radius:4px;font-size:11px;font-weight:400;padding:2px 6px}.uicm-spinner{animation:uicm-spin 1s linear infinite;border:2px solid hsla(0,0%,100%,.3);border-radius:50%;border-top-color:#fff;height:16px;width:16px}.uicm-error-message{animation:uicm-shake .5s ease-in-out;backdrop-filter:blur(8px);background:linear-gradient(135deg,rgba(239,68,68,.1),rgba(220,38,38,.05));border:1px solid rgba(239,68,68,.3);border-radius:12px;color:var(--uicm-danger,#ef4444);font-size:13px;font-weight:500;margin-top:12px;padding:12px 16px}@keyframes uicm-form-slide-in{0%{opacity:0;transform:translateY(20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}@keyframes uicm-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes uicm-shake{0%,to{transform:translateX(0)}25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}@keyframes uicm-pulse{0%,to{opacity:1;transform:scale(1)}50%{opacity:.8;transform:scale(1.1)}}.uicm-paste-loading{align-items:center;backdrop-filter:blur(10px);background:hsla(0,0%,100%,.95);border:1px solid rgba(59,130,246,.2);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.1);color:#1e293b;display:flex;font-size:14px;gap:12px;left:50%;padding:16px 24px;position:absolute;top:50%;transform:translate(-50%,-50%);z-index:1000}.uicm-loading-spinner{animation:uicm-spin 1s linear infinite;border:2px solid #e2e8f0;border-radius:50%;border-top-color:#3b82f6;height:20px;width:20px}@keyframes uicm-glow-warning{0%,to{text-shadow:0 0 4px rgba(245,158,11,.5)}50%{text-shadow:0 0 8px rgba(245,158,11,.8)}}@keyframes uicm-glow-error{0%,to{text-shadow:0 0 4px rgba(239,68,68,.5)}50%{text-shadow:0 0 8px rgba(239,68,68,.8)}}@media (max-width:480px){.uicm-comment-form{margin:10px;max-width:95vw;min-width:320px}.uicm-form-header-content{align-items:flex-start;flex-direction:column;gap:12px;padding:20px 20px 16px}.uicm-form-title-section{width:100%}.uicm-form-action-section{align-self:flex-end}.uicm-form-content{padding:20px}.uicm-form-actions{flex-direction:column;gap:16px}.uicm-primary-actions{justify-content:space-between;width:100%}.uicm-cancel-button,.uicm-submit-button{flex:1;text-align:center}.uicm-secondary-actions{justify-content:center;width:100%}.uicm-user-avatar{font-size:16px;height:40px;width:40px}.uicm-user-avatar:after{height:12px;width:12px}}.uicm-comment-form button,.uicm-comment-form input,.uicm-comment-form select,.uicm-comment-form textarea{pointer-events:auto!important;position:relative;z-index:1!important}.uicm-comment-form{pointer-events:auto!important;position:relative;z-index:999999!important}.uicm-form-header-bar{background:linear-gradient(90deg,#3b82f6,#06b6d4,#10b981);border-radius:8px 8px 0 0;height:4px;left:0;position:absolute;right:0;top:0;z-index:1}');i(".uicm-profile-modal{align-items:center;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;height:100%;justify-content:center;left:0;position:fixed;top:0;width:100%;z-index:10000000}.uicm-profile-modal-overlay{backdrop-filter:blur(4px);background-color:rgba(0,0,0,.5);height:100%;left:0;position:absolute;top:0;width:100%}.uicm-profile-modal-content{animation:uicm-modal-slide-in .3s ease-out;background:#fff;border-radius:12px;box-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04);max-height:90vh;max-width:480px;overflow:hidden;position:relative;width:90%}@keyframes uicm-modal-slide-in{0%{opacity:0;transform:scale(.95) translateY(-10px)}to{opacity:1;transform:scale(1) translateY(0)}}.uicm-profile-modal-header{align-items:center;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;padding:24px 24px 20px}.uicm-profile-modal-title{color:#111827;font-size:20px;font-weight:600;margin:0}.uicm-profile-modal-close{align-items:center;background:none;border:none;border-radius:6px;color:#6b7280;cursor:pointer;display:flex;justify-content:center;padding:8px;transition:all .2s}.uicm-profile-modal-close:hover{background-color:#f3f4f6;color:#374151}.uicm-profile-modal-body{max-height:60vh;overflow-y:auto;padding:24px}.uicm-profile-avatar-section{align-items:center;background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;display:flex;gap:16px;margin-bottom:32px;padding:20px}.uicm-profile-avatar{align-items:center;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:50%;display:flex;flex-shrink:0;height:64px;justify-content:center;width:64px}.uicm-profile-avatar-text{color:#fff;font-size:24px;font-weight:600;text-transform:uppercase}.uicm-profile-avatar-info{flex:1}.uicm-profile-avatar-label{color:#374151;font-size:14px;font-weight:500;margin:0 0 4px}.uicm-profile-avatar-subtitle{color:#6b7280;font-size:13px;margin:0}.uicm-profile-form{display:flex;flex-direction:column;gap:24px}.uicm-form-group{display:flex;flex-direction:column;gap:8px}.uicm-form-label{color:#374151;font-size:14px;font-weight:500;margin:0}.uicm-form-input,.uicm-form-select{background:#fff;border:1px solid #d1d5db;border-radius:8px;color:#111827;font-family:inherit;font-size:14px;padding:12px 16px;transition:all .2s}.uicm-form-input:focus,.uicm-form-select:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1);outline:none}.uicm-form-input-error,.uicm-form-input-error:focus{border-color:#ef4444;box-shadow:0 0 0 3px rgba(239,68,68,.1)}.uicm-form-help{color:#6b7280;font-size:12px;margin:0}.uicm-profile-modal-footer{align-items:center;background:#f9fafb;border-top:1px solid #e5e7eb;display:flex;gap:12px;justify-content:flex-end;padding:20px 24px}.uicm-btn{align-items:center;border:none;border-radius:8px;cursor:pointer;display:inline-flex;font-family:inherit;font-size:14px;font-weight:500;justify-content:center;min-width:80px;padding:10px 20px;transition:all .2s}.uicm-btn:disabled{cursor:not-allowed;opacity:.6}.uicm-btn-secondary{background:#fff;border:1px solid #d1d5db;color:#374151}.uicm-btn-secondary:hover:not(:disabled){background:#f9fafb;border-color:#9ca3af}.uicm-btn-primary{background:#3b82f6;color:#fff}.uicm-btn-primary:hover:not(:disabled){background:#2563eb}@media (prefers-color-scheme:dark){.uicm-profile-modal-content{background:#1f2937;color:#f9fafb}.uicm-profile-modal-title{color:#f9fafb}.uicm-profile-modal-close{color:#9ca3af}.uicm-profile-modal-close:hover{background-color:#374151;color:#d1d5db}.uicm-profile-avatar-section{background:#374151;border-color:#4b5563}.uicm-form-label{color:#d1d5db}.uicm-form-input,.uicm-form-select{background:#374151;border-color:#4b5563;color:#f9fafb}.uicm-form-input:focus,.uicm-form-select:focus{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(96,165,250,.1)}.uicm-form-help{color:#9ca3af}.uicm-profile-modal-footer{background:#374151;border-color:#4b5563}.uicm-btn-secondary{background:#4b5563;border-color:#6b7280;color:#f9fafb}.uicm-btn-secondary:hover:not(:disabled){background:#6b7280;border-color:#9ca3af}}@media (max-width:640px){.uicm-profile-modal-content{margin:20px;width:95%}.uicm-profile-modal-body,.uicm-profile-modal-footer,.uicm-profile-modal-header{padding:16px}.uicm-profile-avatar-section{flex-direction:column;gap:12px;text-align:center}.uicm-profile-modal-footer{flex-direction:column-reverse;gap:8px}.uicm-btn{width:100%}}");i('.uicm-settings-button{align-items:center;background:#fff;border:2px solid #e5e7eb;border-radius:50%;bottom:20px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);color:#6b7280;cursor:pointer;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;height:48px;justify-content:center;opacity:1;position:fixed;right:20px;transform:scale(1) translateY(0);transition:all .3s cubic-bezier(.4,0,.2,1);width:48px;z-index:9999999999}.uicm-settings-button[style*="display: none"]{opacity:0;pointer-events:none;transform:scale(.8) translateY(20px)}.uicm-settings-button:hover{background:#f9fafb;border-color:#d1d5db;box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05);color:#374151;transform:scale(1.05)}.uicm-settings-button:active{transform:scale(.95)}.uicm-settings-button:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1);outline:none}.uicm-settings-icon{height:100%;width:100%}.uicm-gear-icon,.uicm-settings-icon{align-items:center;display:flex;justify-content:center}.uicm-gear-icon{color:inherit;font-size:30px;height:20px;transition:transform .3s ease;width:20px}@media (prefers-color-scheme:dark){.uicm-settings-button{background:#374151;border-color:#4b5563;color:#d1d5db}.uicm-settings-button:hover{background:#4b5563;border-color:#6b7280;color:#f9fafb}.uicm-settings-button:focus{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(96,165,250,.1)}}@media (max-width:640px){.uicm-settings-button{bottom:16px;height:44px;right:16px;width:44px}.uicm-gear-icon{font-size:18px;height:18px;width:18px}}');i('.uicm-sidebar-button{align-items:center;background:#fff;border:2px solid #e5e7eb;border-radius:50%;bottom:80px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);color:#6b7280;cursor:pointer;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;height:48px;justify-content:center;opacity:1;position:fixed;right:20px;transform:scale(1) translateY(0);transition:all .3s cubic-bezier(.4,0,.2,1);width:48px;z-index:9999999999999}.uicm-sidebar-button[style*="display: none"]{opacity:0;pointer-events:none;transform:scale(.8) translateY(20px)}.uicm-sidebar-button:hover{background:#f9fafb;border-color:#d1d5db;box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05);color:#374151;transform:scale(1.05)}.uicm-sidebar-button:active{transform:scale(.95)}.uicm-sidebar-button:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1);outline:none}.uicm-sidebar-icon{height:100%;width:100%}.uicm-list-icon,.uicm-sidebar-icon{align-items:center;display:flex;justify-content:center}.uicm-list-icon{color:inherit;font-size:20px;height:20px;line-height:1;transition:transform .3s ease;width:20px}.uicm-sidebar-button:hover .uicm-list-icon{transform:scale(1.1)}@media (prefers-color-scheme:dark){.uicm-sidebar-button{background:#374151;border-color:#4b5563;color:#d1d5db}.uicm-sidebar-button:hover{background:#4b5563;border-color:#6b7280;color:#f9fafb}.uicm-sidebar-button:focus{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(96,165,250,.1)}}@media (max-width:640px){.uicm-sidebar-button{bottom:76px;height:44px;right:16px;width:44px}.uicm-list-icon{font-size:18px;height:18px;width:18px}}');class I{static loadComments(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){return JSON.parse(e).comments||[]}}catch(e){console.error("Failed to load comments from storage:",e)}return[]}static saveComments(e){try{const t={comments:e,lastUpdated:(new Date).toISOString()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(e){console.error("Failed to save comments to storage:",e)}}static addComment(e){const t=this.loadComments(),o={...e,id:this.generateId(),createdAt:(new Date).toISOString()};return t.push(o),this.saveComments(t),o}static updateComment(e){const t=this.loadComments(),o=t.findIndex(t=>t.id===e.id);return-1!==o&&(t[o]=e,this.saveComments(t)),e}static deleteComment(e){const t=this.loadComments().filter(t=>t.id!==e);this.saveComments(t)}static getCommentsForUrl(e){return this.loadComments().filter(t=>t.url===e)}static getCommentsForXPath(e,t){return this.loadComments().filter(o=>o.xpath===e&&o.url===t)}static clearAllComments(){localStorage.removeItem(this.STORAGE_KEY)}static exportComments(){const e=this.loadComments();return JSON.stringify({comments:e,exportedAt:(new Date).toISOString(),version:"1.0.0"},null,2)}static importComments(e){try{const t=JSON.parse(e);t.comments&&Array.isArray(t.comments)&&this.saveComments(t.comments)}catch(e){console.error("Failed to import comments:",e)}}static generateId(){return"comment_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}static getStorageInfo(){const e=this.loadComments(),t=localStorage.getItem(this.STORAGE_KEY),o=t?new Blob([t]).size:0;let n=null;try{n=JSON.parse(t||"{}").lastUpdated||null}catch(e){}return{totalComments:e.length,storageSize:o,lastUpdated:n}}}I.STORAGE_KEY="uicm-comments";const A={loadAll:()=>{r.loadComments().then(e=>{console.log("Loaded comments:",e),alert(`Loaded ${e.length} comments from storage`)})},syncToFile:()=>{r.syncToFile()},clearAll:()=>{r.clearAllComments().then(()=>{alert("All comments cleared!"),location.reload()})},showInstructions:()=>{console.log("🔧 Hybrid Storage Instructions:"),console.log("- Comments are saved to localStorage + exported to JSON file"),console.log("- Use loadAll() to load comments from storage"),console.log("- Use syncToFile() to download comments as JSON"),console.log("- Use clearAll() to clear all comments")}};class D{constructor(){this.commentsKey="uicm-comments",this.userProfileKey="uicm-user-profile",this.projectKey="uicm-demo-project"}getCommentsData(){try{const e=localStorage.getItem(this.commentsKey);if(!e)return console.log("📭 No comments data found in localStorage"),null;const t=JSON.parse(e);return console.log("📂 Comments data loaded from localStorage:",t),t}catch(e){return console.error("❌ Failed to load comments data from localStorage:",e),null}}getAllUICMData(){const e={};try{for(let t=0;t<localStorage.length;t++){const o=localStorage.key(t);if(o&&o.startsWith("uicm-"))try{const t=localStorage.getItem(o);t&&(e[o]=JSON.parse(t))}catch(t){console.warn(`⚠️ Failed to parse localStorage key: ${o}`,t),e[o]=localStorage.getItem(o)}}return console.log("📊 All UICM data from localStorage:",e),e}catch(e){return console.error("❌ Failed to get all UICM data:",e),{}}}clearCommentsData(){try{localStorage.removeItem(this.commentsKey),console.log("🗑️ Comments data cleared from localStorage")}catch(e){console.error("❌ Failed to clear comments data:",e)}}exportCommentsData(){try{const e=this.getCommentsData();if(!e)return"";const t={timestamp:(new Date).toISOString(),data:e,version:"1.0.0"},o=JSON.stringify(t,null,2);return console.log("📤 Comments data exported:",t),o}catch(e){return console.error("❌ Failed to export comments data:",e),""}}importCommentsData(e){try{const t=JSON.parse(e),o=t.data||t;return localStorage.setItem(this.commentsKey,JSON.stringify(o)),console.log("📥 Comments data imported to localStorage:",o),!0}catch(e){return console.error("❌ Failed to import comments data:",e),!1}}getProjectData(e){try{const t=`uicm-${e}`,o=localStorage.getItem(t);if(!o)return console.log(`📭 No project data found for: ${e}`),null;const n=JSON.parse(o);return console.log(`📂 Project data loaded for ${e}:`,n),n}catch(t){return console.error(`❌ Failed to load project data for ${e}:`,t),null}}getUserProfileData(){try{const e=localStorage.getItem(this.userProfileKey);if(!e)return console.log("📭 No user profile data found in localStorage"),null;const t=JSON.parse(e);return console.log("📂 User profile data loaded from localStorage:",t),t}catch(e){return console.error("❌ Failed to load user profile data from localStorage:",e),null}}displayAllData(){const e=this.getAllUICMData();console.group("🔍 UICM LocalStorage Data"),console.log("Total UICM keys found:",Object.keys(e).length),Object.keys(e).forEach(t=>{const o=e[t];console.group(`📁 ${t}`),console.log("Type:",typeof o),console.log("Size:",JSON.stringify(o).length,"characters"),console.log("Data:",o),console.groupEnd()}),console.groupEnd()}}const O=new D;var $={initCommentSDK:F};exports.CommentSDK=B,exports.CommentStorage=I,exports.HybridCommentStorage=r,exports.LocalStorageManager=D,exports.LocalUserProfileStorage=c,exports.ProfileSettingsModal=l,exports.SettingsButton=d,exports.VERSION="1.0.0",exports.createHybridStorageConfig=function(e="demo-project"){return{projectId:e,currentUser:{id:"user_demo",name:"Demo User",avatar:void 0},theme:"light",onLoadComments:async()=>await r.loadComments(),onSaveComment:async e=>await r.addComment(e),onDeleteComment:async e=>{await r.deleteComment(e)},onUpdateComment:async e=>await r.updateComment(e)}},exports.default=$,exports.hybridStorageUtils=A,exports.initCommentSDK=F,exports.localStorageUtils=O,exports.userProfileStorage=m;
